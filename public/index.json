[{"categories":["Cloud"],"contents":"Overview Here\u0026rsquo;s a comprehensive script to audit all your Conditional Access policies.\nThis script connects to Microsoft Graph, retrieves all CA policies, and provides detailed information about each one including user assignments, applications, conditions, and grant controls.\nIt also checks whether your break-glass account is properly excluded from each policy.\nThe Script # Comprehensive CA Policy Audit Script # Run this to get full details of all your policies Connect-MgGraph -Scopes \u0026#34;Policy.Read.All\u0026#34;, \u0026#34;User.Read.All\u0026#34; Write-Host \u0026#34;`n=== CONDITIONAL ACCESS POLICY AUDIT ===\u0026#34; -ForegroundColor Cyan Write-Host \u0026#34;Date: $(Get-Date -Format \u0026#39;yyyy-MM-dd HH:mm\u0026#39;)`n\u0026#34; -ForegroundColor Gray # Get break-glass account ID for exclusion check $breakGlassUPN = \u0026#34;breakglass@devworkplace.cloud\u0026#34; $breakGlassUser = Get-MgUser -Filter \u0026#34;userPrincipalName eq \u0026#39;$breakGlassUPN\u0026#39;\u0026#34; -ErrorAction SilentlyContinue $breakGlassId = if ($breakGlassUser) { $breakGlassUser.Id } else { \u0026#34;NOT FOUND\u0026#34; } Write-Host \u0026#34;Break-Glass Account: $breakGlassUPN\u0026#34; -ForegroundColor Yellow Write-Host \u0026#34;Break-Glass ID: $breakGlassId`n\u0026#34; -ForegroundColor Gray # Get all CA policies $policies = Get-MgIdentityConditionalAccessPolicy foreach ($policy in $policies) { Write-Host \u0026#34;========================================\u0026#34; -ForegroundColor DarkGray Write-Host \u0026#34;POLICY: $($policy.DisplayName)\u0026#34; -ForegroundColor Green Write-Host \u0026#34;State: $($policy.State)\u0026#34; -ForegroundColor $(if ($policy.State -eq \u0026#34;enabled\u0026#34;) {\u0026#34;Green\u0026#34;} else {\u0026#34;Yellow\u0026#34;}) Write-Host \u0026#34;Created: $($policy.CreatedDateTime)\u0026#34; Write-Host \u0026#34;Modified: $($policy.ModifiedDateTime)\u0026#34; # Users Write-Host \u0026#34;`n--- USERS ---\u0026#34; -ForegroundColor Cyan Write-Host \u0026#34;Include Users: $($policy.Conditions.Users.IncludeUsers -join \u0026#39;, \u0026#39;)\u0026#34; Write-Host \u0026#34;Include Groups: $($policy.Conditions.Users.IncludeGroups -join \u0026#39;, \u0026#39;)\u0026#34; Write-Host \u0026#34;Include Roles: $($policy.Conditions.Users.IncludeRoles -join \u0026#39;, \u0026#39;)\u0026#34; Write-Host \u0026#34;Exclude Users: $($policy.Conditions.Users.ExcludeUsers -join \u0026#39;, \u0026#39;)\u0026#34; Write-Host \u0026#34;Exclude Groups: $($policy.Conditions.Users.ExcludeGroups -join \u0026#39;, \u0026#39;)\u0026#34; # Break-glass exclusion check $bgExcluded = $policy.Conditions.Users.ExcludeUsers -contains $breakGlassId Write-Host \u0026#34;Break-Glass Excluded: $bgExcluded\u0026#34; -ForegroundColor $(if ($bgExcluded) {\u0026#34;Green\u0026#34;} else {\u0026#34;Red\u0026#34;}) # Applications Write-Host \u0026#34;`n--- APPLICATIONS ---\u0026#34; -ForegroundColor Cyan Write-Host \u0026#34;Include Apps: $($policy.Conditions.Applications.IncludeApplications -join \u0026#39;, \u0026#39;)\u0026#34; Write-Host \u0026#34;Exclude Apps: $($policy.Conditions.Applications.ExcludeApplications -join \u0026#39;, \u0026#39;)\u0026#34; # Conditions Write-Host \u0026#34;`n--- CONDITIONS ---\u0026#34; -ForegroundColor Cyan Write-Host \u0026#34;Platforms: $($policy.Conditions.Platforms.IncludePlatforms -join \u0026#39;, \u0026#39;)\u0026#34; Write-Host \u0026#34;Locations Include: $($policy.Conditions.Locations.IncludeLocations -join \u0026#39;, \u0026#39;)\u0026#34; Write-Host \u0026#34;Locations Exclude: $($policy.Conditions.Locations.ExcludeLocations -join \u0026#39;, \u0026#39;)\u0026#34; Write-Host \u0026#34;Client Apps: $($policy.Conditions.ClientAppTypes -join \u0026#39;, \u0026#39;)\u0026#34; Write-Host \u0026#34;Sign-in Risk: $($policy.Conditions.SignInRiskLevels -join \u0026#39;, \u0026#39;)\u0026#34; Write-Host \u0026#34;User Risk: $($policy.Conditions.UserRiskLevels -join \u0026#39;, \u0026#39;)\u0026#34; # Grant Controls Write-Host \u0026#34;`n--- GRANT CONTROLS ---\u0026#34; -ForegroundColor Cyan Write-Host \u0026#34;Operator: $($policy.GrantControls.Operator)\u0026#34; Write-Host \u0026#34;Built-in Controls: $($policy.GrantControls.BuiltInControls -join \u0026#39;, \u0026#39;)\u0026#34; if ($policy.GrantControls.AuthenticationStrength) { Write-Host \u0026#34;Authentication Strength: $($policy.GrantControls.AuthenticationStrength.DisplayName)\u0026#34; -ForegroundColor Magenta } if ($policy.GrantControls.TermsOfUse) { Write-Host \u0026#34;Terms of Use: $($policy.GrantControls.TermsOfUse -join \u0026#39;, \u0026#39;)\u0026#34; } # Session Controls Write-Host \u0026#34;`n--- SESSION CONTROLS ---\u0026#34; -ForegroundColor Cyan if ($policy.SessionControls) { Write-Host \u0026#34;Sign-in Frequency: $($policy.SessionControls.SignInFrequency.Value) $($policy.SessionControls.SignInFrequency.Type)\u0026#34; Write-Host \u0026#34;Persistent Browser: $($policy.SessionControls.PersistentBrowser.Mode)\u0026#34; } else { Write-Host \u0026#34;None configured\u0026#34; } Write-Host \u0026#34;\u0026#34; } # Summary Write-Host \u0026#34;`n=== SUMMARY ===\u0026#34; -ForegroundColor Cyan Write-Host \u0026#34;Total Policies: $($policies.Count)\u0026#34; Write-Host \u0026#34;Enabled: $(($policies | Where-Object {$_.State -eq \u0026#39;enabled\u0026#39;}).Count)\u0026#34; Write-Host \u0026#34;Report-Only: $(($policies | Where-Object {$_.State -eq \u0026#39;enabledForReportingButNotEnforced\u0026#39;}).Count)\u0026#34; Write-Host \u0026#34;Disabled: $(($policies | Where-Object {$_.State -eq \u0026#39;disabled\u0026#39;}).Count)\u0026#34; # Break-glass exclusion summary $missingExclusions = $policies | Where-Object { $_.Conditions.Users.ExcludeUsers -notcontains $breakGlassId } if ($missingExclusions.Count -gt 0) { Write-Host \u0026#34;`nWARNING: Break-glass NOT excluded from:\u0026#34; -ForegroundColor Red $missingExclusions | ForEach-Object { Write-Host \u0026#34; - $($_.DisplayName)\u0026#34; -ForegroundColor Red } } else { Write-Host \u0026#34;`nBreak-glass excluded from all policies\u0026#34; -ForegroundColor Green } Prerequisites Before running this script, ensure you have:\nMicrosoft Graph PowerShell SDK installed Appropriate permissions (Policy.Read.All, User.Read.All) Access to your Entra ID tenant What It Checks For each Conditional Access policy, the script displays:\nPolicy name, state, and timestamps User and group inclusions/exclusions Application scope Platform and location conditions Client app types and risk levels Grant controls (MFA, compliant device, etc.) Session controls (sign-in frequency, persistent browser) Break-glass account exclusion status ","date":"2026-01-04","permalink":"http://localhost:1313/posts/comprehensive-ca-policy-audit-script/","tags":["PowerShell","Entra ID","Conditional Access","Security"],"title":"Comprehensive CA Policy Audit Script"},{"categories":["General"],"contents":"Who I Am I work in IT, mainly around Microsoft environments. Most of my day-to-day work involves building, fixing, and securing systems based on:\nMicrosoft SCCM, Intune, Azure, Entra ID, and Microsoft 365 VMware virtualization PowerShell for automation and troubleshooting I care more about what actually works in production than what looks good on slides.\nWhat You Will Find Here This blog is a collection of solutions and notes taken from real issues I\u0026rsquo;ve had to solve:\nStep-by-step guides based on actual implementations PowerShell scripts I use in real environments Troubleshooting notes and lessons learned Observations from working with Microsoft infrastructure at scale The goal is to keep things practical, direct, and reproducible.\nWhy This Blog Exists I started writing things down because I kept solving the same problems more than once. If something took time to research, test, or fix, it\u0026rsquo;s worth documenting.\nThis site is mainly for people who work with these technologies every day, including future me.\n","date":"2025-12-23","permalink":"http://localhost:1313/posts/welcome-to-halfoncloud/","tags":["About"],"title":"Welcome to HalfOnCloud"},{"categories":null,"contents":"Hi, I\u0026rsquo;m Radu IT professional specializing in Microsoft technologies: SCCM, Intune, Azure, EntraID, and M365. I also work with VMware for virtualization.\nThis blog is where I share tutorials, automation scripts, and insights from my daily work.\n","date":"2025-01-01","permalink":"http://localhost:1313/about/","tags":null,"title":"About"},{"cate