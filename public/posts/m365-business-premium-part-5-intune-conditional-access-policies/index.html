<!doctype html><html lang=en><head><title>M365 Business Premium Part 5: Conditional Access Policies :: HalfOnCloud</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Microsoft Entra ID Conditional Access Policies explained in detail"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://halfoncloud.com/posts/m365-business-premium-part-5-intune-conditional-access-policies/><link rel=stylesheet href=https://halfoncloud.com/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://halfoncloud.com/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://halfoncloud.com/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://halfoncloud.com/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://halfoncloud.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://halfoncloud.com/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://halfoncloud.com/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://halfoncloud.com/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://halfoncloud.com/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://halfoncloud.com/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://halfoncloud.com/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://halfoncloud.com/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://halfoncloud.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://halfoncloud.com/style.css><link rel="shortcut icon" href=https://halfoncloud.com/favicon.png><link rel=apple-touch-icon href=https://halfoncloud.com/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="M365 Business Premium Part 5: Conditional Access Policies"><meta property="og:description" content="Microsoft Entra ID Conditional Access Policies explained in detail"><meta property="og:url" content="https://halfoncloud.com/posts/m365-business-premium-part-5-intune-conditional-access-policies/"><meta property="og:site_name" content="HalfOnCloud"><meta property="og:image" content="https://halfoncloud.com/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="Cloud"><meta property="article:published_time" content="2026-01-19 00:00:00 +0000 UTC"><script async src="https://www.googletagmanager.com/gtag/js?id=G-9NQJGGWW9C"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9NQJGGWW9C")</script><style>body{font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,sans-serif!important;font-size:1.05rem!important}h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,sans-serif!important;font-weight:700!important}article h1,article h2,article h3,article.post h1,article.post h2,article.post h3,.content h1,.content h2,.content h3{color:#4a9eff!important;border-bottom:none!important}article.post .post-title{color:#4a9eff!important;border-bottom:none!important}article.post .post-title a{color:#4a9eff!important}.logo{background:0 0!important;padding-left:0!important;margin-left:0!important}.header__logo::after{margin-left:10px;background:repeating-linear-gradient(90deg,#4a9eff,#4a9eff 2px,transparent 0,transparent 10px)!important}img{border:none!important}article a,.post-content a{color:#4a9eff!important}article a:hover,.post-content a:hover{color:#6bb3ff!important}body,html{background-color:#1a1d2e!important}.header{margin-bottom:30px!important}.post.on-list{background:#363636;padding:20px;margin-bottom:20px;border-radius:8px}.post-title a{font-size:1.4rem!important;color:#4a9eff!important}.post-title{border-bottom:none!important;padding-bottom:0!important}.post-title::after,h1::after,h2::after,h3::after{display:none!important}.post-tags{color:#4a9eff!important}.post-tags a{color:#4a9eff!important}.post-tags a:hover{color:#6bb0ff!important}.navigation-menu a{color:#4a9eff!important}.navigation-menu a:hover{color:#6bb0ff!important}.menu__trigger{color:#4a9eff!important;border:2px solid #4a9eff!important;background-color:transparent!important}.menu__dropdown{background-color:#363636!important;border:2px solid #4a9eff!important}.menu__dropdown a{color:#4a9eff!important}.menu__dropdown a:hover{color:#6bb0ff!important;background-color:#404040!important}.read-more.button{display:inline-block!important;background-color:#4a9eff!important;color:#fff!important;padding:8px 18px!important;border-radius:28px!important;text-decoration:none!important;font-weight:600!important;transition:all .3s ease!important;border:none!important;font-size:0!important}.read-more.button::after{content:"Read More →"!important;font-size:.99rem!important;display:inline-block}.read-more.button:hover{background-color:#6bb0ff!important;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.2)}article ul,.post-content ul{list-style:none!important}article ul li,.post-content ul li{position:relative!important;padding-left:1.2em!important}article ul li::before,.post-content ul li::before{content:"●"!important;position:absolute!important;left:0!important;color:#4a9eff!important;font-weight:700!important}article ul ul li::before,.post-content ul ul li::before{content:"○"!important;color:#4a9eff!important}.sidebar-left ul li::before,.sidebar-right ul li::before,.sidebar-nav ul li::before,.widget-list li::before{content:none!important;display:none!important}.sidebar-left ul li,.sidebar-right ul li,.sidebar-nav ul li,.widget-list li{padding-left:0!important}.heading-link,.anchor,.zola-anchor,h1 a.anchor,h2 a.anchor,h3 a.anchor,h1>a[href^="#"],h2>a[href^="#"],h3>a[href^="#"]{display:none!important;visibility:hidden!important}.sidebar-nav a{font-weight:700!important}.sidebar-title{font-size:1.8rem!important}body.three-column-layout{display:flex;min-height:100vh;margin:0;padding:0}.sidebar-left{width:250px;min-width:250px;background-color:#13151f;border-right:1px solid #2a2d3e;position:fixed;left:0;top:0;height:100vh;overflow-y:auto;z-index:100}.sidebar-left__inner{padding:30px 20px;display:flex;flex-direction:column;align-items:center}.sidebar-avatar{margin-bottom:15px}.avatar-img{width:120px;height:120px;border-radius:50%;object-fit:cover;border:3px solid #4a9eff}.avatar-placeholder{width:120px;height:120px;border-radius:50%;background:linear-gradient(135deg,#4a9eff 0%,#6bb0ff 100%);display:flex;align-items:center;justify-content:center;font-size:3rem;font-weight:700;color:#fff}.sidebar-title{font-size:1.5rem;margin:10px 0 5px;text-align:center}.sidebar-title a{color:#fff;text-decoration:none}.sidebar-title .red{color:#f44}.sidebar-tagline{font-size:.85rem;color:#888;text-align:center;margin:0 0 25px;line-height:1.4}.sidebar-nav ul{list-style:none;padding:0;margin:0;width:100%}.sidebar-nav li{margin:5px 0}.sidebar-nav a{display:flex;align-items:center;gap:12px;padding:12px 20px;color:#ccc;text-decoration:none;border-radius:8px;transition:all .2s ease;font-size:.95rem}.sidebar-nav a:hover{background-color:#2a2d3e;color:#4a9eff}.sidebar-nav li.active a{background-color:#4a9eff;color:#fff}.sidebar-nav svg{flex-shrink:0}.main-wrapper{flex:1;margin-left:250px;margin-right:280px;min-height:100vh;padding:30px 40px;max-width:950px}.sidebar-right{width:280px;min-width:280px;background-color:#151822;border-left:1px solid #2a2d3e;position:fixed;right:0;top:0;height:100vh;overflow-y:auto;z-index:100}.sidebar-right__inner{padding:30px 20px}.widget{margin-bottom:30px}.widget-title{font-size:1rem;color:#fff;margin:0 0 15px;padding-bottom:10px;border-bottom:1px solid #2a2d3e}.widget-list{list-style:none;padding:0;margin:0}.widget-list li{margin:8px 0}.widget-list a{color:#ccc;text-decoration:none;font-size:.9rem;display:block;padding:5px 0;transition:color .2s ease}.widget-list a:hover{color:#4a9eff}.widget-tags{display:flex;flex-wrap:wrap;gap:8px}.widget-tag{display:inline-block;padding:5px 12px;background-color:#2a2d3e;color:#ccc;text-decoration:none;border-radius:15px;font-size:.8rem;transition:all .2s ease}.widget-tag:hover{background-color:#4a9eff;color:#fff}.widget-tag .count{margin-left:5px;opacity:.7}.archives h1{color:#4a9eff;margin-bottom:30px}.archive-year h2{color:#4a9eff;font-size:1.3rem;margin:25px 0 15px;padding-left:10px;border-left:3px solid #4a9eff}.archive-posts{list-style:none;padding:0;margin:0}.archive-posts li{padding:8px 0;display:flex;align-items:center;gap:15px}.archive-date{color:#888;font-size:.85rem;min-width:60px}.archive-posts a{color:#ccc;text-decoration:none}.archive-posts a:hover{color:#4a9eff}body.three-column-layout .header{display:none}@media(max-width:1200px){.sidebar-right{display:none}.main-wrapper{margin-right:0}}@media(max-width:768px){body.three-column-layout{flex-direction:column}.sidebar-left{width:100%;min-width:100%;position:relative;height:auto;border-right:none;border-bottom:1px solid #2a2d3e}.sidebar-left__inner{padding:20px;height:auto}.sidebar-nav ul{display:flex;flex-wrap:wrap;justify-content:center;gap:5px}.sidebar-nav a{padding:8px 15px}.avatar-img,.avatar-placeholder{width:80px;height:80px;font-size:2rem}.main-wrapper{margin-left:0;padding:20px}.sidebar-right{display:none}.sidebar-social{position:relative;bottom:auto;margin-top:15px}}@media(max-width:768px){.sidebar-social{position:relative!important;bottom:auto!important;width:100%!important;margin-top:20px!important;padding-top:15px!important;border-top:1px solid #2a2d3e}.sidebar-nav ul{width:100%}}@media(max-width:768px){.main-wrapper{overflow-x:hidden!important;max-width:100vw!important}article img,.post-content img,.content img{max-width:100%!important;height:auto!important}pre,code{max-width:100%!important;overflow-x:auto!important;white-space:pre-wrap!important;word-wrap:break-word!important}.post-title,article h1,article h2{word-wrap:break-word!important;overflow-wrap:break-word!important}}.search-widget{margin-bottom:25px}.search-box{position:relative;display:flex;align-items:center}.search-icon{position:absolute;left:12px;color:#888;pointer-events:none}#search-input{width:100%;padding:12px 15px 12px 40px;background-color:#2a2d3e;border:1px solid #3a3d4e;border-radius:8px;color:#fff;font-size:.9rem;outline:none;transition:all .2s ease}#search-input:focus{border-color:#4a9eff;box-shadow:0 0 0 3px rgba(74,158,255,.2)}#search-input::placeholder{color:#666}#search-results{margin-top:10px;max-height:400px;overflow-y:auto}#search-results:empty{display:none}.search-result-item{padding:10px;margin:5px 0;background-color:#2a2d3e;border-radius:6px;transition:background-color .2s ease}.search-result-item:hover{background-color:#3a3d4e}.search-result-item a{color:#4a9eff;text-decoration:none;font-size:.9rem;display:block}.search-result-item .search-date{font-size:.75rem;color:#888;margin-top:3px}.search-result-item .search-snippet{font-size:.8rem;color:#aaa;margin-top:5px;line-height:1.4}.search-no-results{color:#888;font-size:.85rem;padding:10px;text-align:center}.post-featured-image{margin:20px 0 30px;border-radius:8px;overflow:hidden}.post-featured-image img{width:100%;height:auto;display:block}.terms h1{color:#4a9eff!important;margin-bottom:20px}.terms ul{list-style:none!important;padding:0;margin:0}.terms li{margin:12px 0;display:flex;align-items:center;gap:10px}.terms li::before{display:none!important;content:none!important}.terms li svg{color:#4a9eff!important;flex-shrink:0}.terms a,.terms li a,.terms ul li a{color:#4a9eff!important;text-decoration:none!important;font-size:1.1rem;transition:color .2s ease}.terms a:hover,.terms li a:hover,.terms ul li a:hover{color:#6bb0ff!important}.main-wrapper{margin:0 auto!important}.avatar-img{width:300px!important;height:auto!important;border-radius:20px!important;object-fit:contain!important}.sidebar-social{display:flex;gap:15px;justify-content:center;position:absolute;bottom:30px;left:0;right:0}.sidebar-social a{color:#888;transition:color .2s ease}.sidebar-social a:hover{color:#4a9eff}blockquote{border-left:4px solid red!important;background-color:rgba(255,107,107,3%)!important;background-color:transparent!important;margin:1.5em 0!important;padding:15px 20px!important;border-radius:0 8px 8px 0!important;color:#ccc!important;border-top:none!important;border-right:none!important;border-bottom:none!important}blockquote p{margin:0!important}blockquote::before{content:none!important;display:none!important}pre{white-space:pre-wrap!important;word-wrap:break-word!important;overflow-x:hidden!important}pre code{white-space:pre-wrap!important;word-wrap:break-word!important}table,th,td{border-width:2px!important;border-color:#2a2d3e!important}</style></head><body class=three-column-layout><aside class=sidebar-left><div class=sidebar-left__inner><div class=sidebar-avatar><a href=https://halfoncloud.com/><img src=/images/avatar.png alt=HalfOnCloud class=avatar-img></a></div><h2 class=sidebar-title><a href=https://halfoncloud.com/>Half<span class=red>On</span>Cloud</a></h2><p class=sidebar-tagline>IT tutorials, automation scripts, and real-world solutions</p><nav class=sidebar-nav><ul><li><a href=https://halfoncloud.com/><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
Home</a></li><li><a href=https://halfoncloud.com/categories/><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
Categories</a></li><li><a href=https://halfoncloud.com/tags/><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
Tags</a></li><li><a href=https://halfoncloud.com/archives/><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
Archives</a></li><li><a href=https://halfoncloud.com/about/><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
About</a></li></ul></nav><div class=sidebar-social><a href=https://x.com/HeyRadu target=_blank rel=noopener title=X/Twitter><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
</a><a href=https://linkedin.com/in/radu-bogdan target=_blank rel=noopener title=LinkedIn><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg></a></div></div></aside><aside class=sidebar-right><div class=sidebar-right__inner><div class="widget search-widget"><div class=search-box><svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
<input type=text id=search-input placeholder=Search... autocomplete=off></div><div id=search-results></div></div><div class=widget><h3 class=widget-title>Recent Posts</h3><ul class=widget-list><li><a href=https://halfoncloud.com/posts/m365-business-premium-part-8-anatomy-of-a-failed-enrollment-tracing-an-esp-error-from-screen-to-root-cause/>M365 Business Premium Part 8: Anatomy of a Failed Enrollment - Tracing an ESP Error from Screen to Root Cause</a></li><li><a href=https://halfoncloud.com/posts/m365-business-premium-part-7-intune-autopilot/>M365 Business Premium Part 7: Intune Autopilot Deployment Walkthrough</a></li><li><a href=https://halfoncloud.com/posts/m365-business-premium-part-6-intune-best-practices-device-management-foundations/>M365 Business Premium Part 6: Building the Intune Foundation for Autopilot</a></li><li><a href=https://halfoncloud.com/posts/powershell-script-installer-for-win32-part2-m365-apps-and-delivery-optimization/>M365 Apps Deployment with PowerShell Installer & Delivery Optimization Gotchas</a></li><li><a href=https://halfoncloud.com/posts/m365-business-premium-part-5-intune-conditional-access-policies/>M365 Business Premium Part 5: Conditional Access Policies</a></li></ul></div><div class=widget><h3 class=widget-title>Categories</h3><div class=widget-tags><a href=https://halfoncloud.com/categories/%23deliveryoptimization/ class=widget-tag>#DeliveryOptimization <span class=count>1</span>
</a><a href=https://halfoncloud.com/categories/%23m365apps/ class=widget-tag>#M365Apps <span class=count>1</span>
</a><a href=https://halfoncloud.com/categories/%23msintune/ class=widget-tag>#MSIntune  <span class=count>1</span>
</a><a href=https://halfoncloud.com/categories/%23powershell/ class=widget-tag>#PowerShell <span class=count>1</span>
</a><a href=https://halfoncloud.com/categories/%23win32/ class=widget-tag>#Win32  <span class=count>1</span>
</a><a href=https://halfoncloud.com/categories/cloud/ class=widget-tag>Cloud <span class=count>11</span>
</a><a href=https://halfoncloud.com/categories/general/ class=widget-tag>General <span class=count>1</span></a></div></div><div class=widget><h3 class=widget-title>Tags</h3><div class=widget-tags><a href=https://halfoncloud.com/tags/about/ class=widget-tag>About <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/autopilot/ class=widget-tag>Autopilot <span class=count>2</span>
</a><a href=https://halfoncloud.com/tags/compliancepolicies/ class=widget-tag>CompliancePolicies <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/configurationprofiles/ class=widget-tag>ConfigurationProfiles <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/ddm/ class=widget-tag>DDM <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/devicemanagement/ class=widget-tag>DeviceManagement <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/entraid/ class=widget-tag>EntraID <span class=count>6</span>
</a><a href=https://halfoncloud.com/tags/esp/ class=widget-tag>ESP <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/licensing/ class=widget-tag>Licensing <span class=count>3</span>
</a><a href=https://halfoncloud.com/tags/m365/ class=widget-tag>M365 <span class=count>5</span>
</a><a href=https://halfoncloud.com/tags/mmp-c/ class=widget-tag>MMP-C <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/msintune/ class=widget-tag>MSIntune <span class=count>12</span>
</a><a href=https://halfoncloud.com/tags/powershell/ class=widget-tag>PowerShell <span class=count>2</span>
</a><a href=https://halfoncloud.com/tags/security/ class=widget-tag>Security <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/win32/ class=widget-tag>Win32 <span class=count>2</span>
</a><a href=https://halfoncloud.com/tags/win32apps/ class=widget-tag>Win32Apps <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/windc/ class=widget-tag>WinDC <span class=count>1</span></a></div></div></div></aside><div class=main-wrapper><div class=content><article class=post><header class=post-header><h1 class=post-title>M365 Business Premium Part 5: Conditional Access Policies</h1><div class=post-meta><time class=post-date>2026-01-19 · 14 min read</time>
<span class=post-author>Radu Bogdan</span></div><span class=post-tags>#<a href=https://halfoncloud.com/tags/msintune/>MSIntune</a>&nbsp;
#<a href=https://halfoncloud.com/tags/entraid/>EntraID</a>&nbsp;</span></header><div class=post-content><h2 id=the-policy-dashboard>The Policy Dashboard</h2><p>The Conditional Access policies described below represent a <strong>baseline</strong> starting point for any tenant security. They are not a definitive or complete security model, but a minimal foundation that every tenant should have in place in some form. Whether you adopt these policies directly, adjust their scope or implement a variation that fits your environment, the key point is to <strong>start somewhere</strong> rather than operate without core Conditional Access controls.</p><p>In my tenant, I currently have <strong>8 Conditional Access policies</strong> in total:</p><ul><li><strong>2 Microsoft-managed (default policies)</strong></li><li><strong>6 custom user-created policies</strong></li></ul><p>The Microsoft-managed policies for <strong>blocking legacy authentication</strong> and <strong>requiring phishing-resistant MFA for administrators</strong> are currently set to <em>Off</em>. This is intentional, as I have implemented functionally equivalent policies with custom configurations tailored to my environment.</p><p>My custom policies follow a deliberate and explicit numbering convention (CA-001 through CA-006), making them easier to audit, discuss and troubleshoot, each policy targeting a specific security control:</p><ul><li>CA-001-Require-MFA-Admins</li><li>CA-002-Block-Legacy-Auth</li><li>CA-003-Require-MFA-All-Users</li><li>CA-004-Block-Offline-Autopilot</li><li>CA-005-Require-ToU-All-Users</li><li>CA-006-Block-NonCompliant</li></ul><p>This structure helps keep Conditional Access readable, predictable and maintainable over time, especially as additional policies are introduced:</p><p><img src=/images/Blog_P13_001.jpg alt></p><p><strong>Note</strong>: To keep things readable avoiding unnecessary repetition, I don’t re-show identical Conditional Access sections for every policy, common settings such as <strong>Users and groups</strong> and the usual <strong>Include / Exclude</strong> logic are explained in detail once and then reused across the other policies.</p><p>For each additional policy, I&rsquo;ve focus only on what changes and why it matters. If a setting isn’t shown again, it follows the same pattern already introduced earlier unless I explicitly call out a difference.</p><h2 id=ca-001-require-mfa-for-admins>CA-001: Require MFA for Admins</h2><p>The first policy focuses on privileged identities, rather than targeting individual users, it is scoped to <strong>directory roles</strong>, with nine administrative roles selected. This ensures that Global Administrators, User Administrators, Exchange Administrators and other high-impact roles must complete MFA regardless of where the sign-in originates.</p><p>The critical configuration here is <strong>Select users and groups</strong> with <strong>Directory roles</strong> enabled. This approach is more resilient than assigning named accounts, as the policy automatically applies the moment a user is added to an administrative role and is removed just as cleanly when the role is revoked.</p><p><img src=/images/Blog_P13_002.jpg alt></p><h3 id=the-break-glass-exclusion>The Break-Glass Exclusion</h3><p>Every Conditional Access design needs an explicit emergency access path. I&rsquo;ve exclude a dedicated &ldquo;<em>break-glass</em>&rdquo; account from all Conditional Access policies to guarantee tenant access in case of widespread authentication or policy misconfiguration.</p><p>This account uses a long, complex password stored offline and is never used for daily administration. The account name is intentionally blurred here, publishing break-glass account details publicly is a poor operational security practice.</p><p><img src=/images/Blog_P13_003.jpg alt></p><h3 id=target-resources-and-the-lockout-warning>Target Resources and the Lockout Warning</h3><p>CA-001 targets <strong>All resources (formerly “All cloud apps”)</strong>, meaning every Microsoft 365 service requires MFA for administrative access. Because this is a broad and restrictive scope, Entra ID displays a yellow warning banner reminding you of the risk of self-lockout.</p><p>This warning is expected and appropriate. Any policy that applies to all resources should be deployed cautiously, ideally first in report-only mode or during a controlled change window.</p><p><strong>Note:</strong>: The informational banner referencing Global Secure Access can be ignored unless you are actively deploying Microsoft’s SASE capabilities.</p><p><img src=/images/Blog_P13_004.jpg alt></p><h3 id=grant-controls-for-admin-mfa>Grant Controls for Admin MFA</h3><p>In the Grant controls, <strong>Require multifactor authentication</strong> is selected. Entra ID also surfaces a recommendation for <strong>Authentication Strength</strong>, along with a reminder that MFA and Authentication Strength cannot be combined in the same policy.</p><p>For now, standard MFA meets the intended risk reduction. Phishing-resistant authentication strength is planned for a later iteration once the environment is ready to absorb the stricter controls.</p><p>The <strong>For multiple controls</strong> option becomes relevant when more than one requirement is selected. “Require one of the selected controls” applies OR logic, while “Require all” enforces AND logic:</p><p><img src=/images/Blog_P13_005.jpg alt></p><h2 id=ca-002-block-legacy-authentication>CA-002: Block Legacy Authentication</h2><p>This policy has a fundamentally different goal: deny access outright. Legacy authentication protocols such as IMAP, POP3 and older SMTP variants do not support MFA and remain a common attack surface.</p><p>In the Conditions panel, <strong>Client apps</strong> are configured with two inclusions and the Grant control is set to <strong>Block access</strong>. The selected client apps <strong>Exchange ActiveSync clients</strong> and <strong>Other clients</strong>
cover legacy protocols while leaving modern authentication flows unaffected:</p><p><img src=/images/Blog_P13_009.jpg alt></p><h3 id=block-access-grant-control>Block Access Grant Control</h3><p>Unlike CA-001, which grants access after conditions are met, CA-002 enforces a hard stop. Once <strong>Block access</strong> is selected, all other grant options are disabled. There is no MFA challenge and no fallback condition, authentication simply fails.</p><p>This is the intended behavior, Legacy authentication should not be constrained or partially allowed, it should be removed entirely:</p><p><img src=/images/Blog_P13_010.jpg alt></p><h2 id=ca-003-network-aware-mfa-for-all-users>CA-003: Network-Aware MFA for All Users</h2><p>This policy extends MFA requirements to all users, not just administrators, while remaining aware of network context. The Network (formerly Locations) condition is configured as <strong>Any network or location</strong>, with one exclusion.</p><p>In practice MFA is required everywhere except a trusted home network. This balances usability with security by reducing friction in a controlled environment while maintaining strong authentication everywhere else.</p><p>Note: Microsoft is gradually transitioning location-based conditions into the broader Network model as part of its Global Secure Access strategy.</p><p><img src=/images/Blog_P13_015.jpg alt></p><h3 id=creating-named-locations>Creating Named Locations</h3><p>Named Locations define trusted networks for CA policies. The &ldquo;New location (IP ranges)&rdquo; panel shows creating " " with &ldquo;Mark as trusted location&rdquo; checked. The IP range field shows my subnet representing a single public IP address.</p><p><strong>Note:</strong> I&rsquo;ve blurred the actual IP in the published version. Never expose your home or office public IPs.</p><p><img src=/images/Blog_P13_057.jpg alt></p><p><img src=/images/Blog_P13_058.jpg alt></p><p>After creation, the Named Locations list shows my custom Named Location with <em>Trusted: Yes</em> and a <em>Creation date</em>. The status shows &ldquo;Not configured in any policy yet&rdquo; which will change once I assign it to CA-003&rsquo;s exclusion list next:</p><p><img src=/images/Blog_P13_059.jpg alt></p><h3 id=named-location-exclusions>Named Location Exclusions</h3><p>The exclusion relies on <strong>Named Locations</strong>, my home IP range is explicitly marked as trusted.</p><p>When a user signs in from this location the policy still evaluates, but the MFA requirement is bypassed due to the exclusion. From any other network, MFA is enforced:</p><p><img src=/images/Blog_P13_017.jpg alt></p><h3 id=location-conditions-overview>Location Conditions Overview</h3><p>The Conditions summary reflects a deliberately narrow scope. Network conditions are configured with <strong>Any network or location and 1 excluded</strong>, while Device platforms, Client apps, Filter for devices and Authentication flows remain not configured.</p><p>This is intentional, each policy is designed to do one thing well, CA-003 handles user MFA with network awareness, while device compliance and other signals are enforced elsewhere.</p><p><img src=/images/Blog_P13_018.jpg alt></p><h3 id=selecting-the-excluded-network>Selecting the Excluded Network</h3><p>In the Select networks panel, both named locations are visible, the home network is explicitly selected under the <strong>Exclude</strong> tab using <strong>Selected networks and locations</strong>.</p><p>IP ranges are blurred here for obvious reasons, publishing home or corporate IP addresses is unnecessary and unsafe:</p><p><img src=/images/Blog_P13_020.jpg alt></p><h2 id=ca-003-grant-controls>CA-003 Grant Controls</h2><p>This policy requires <strong>either</strong> MFA <strong>or</strong> acceptance of the Intune Device Management Privacy Notice. By setting <strong>Require one of the selected controls</strong>, the policy applies OR logic between the two conditions.</p><p>This configuration aligns well with Intune enrollment and sign-in flows, where users may need to acknowledge device management terms. Combined with MFA, it enforces both identity assurance and user consent without creating unnecessary sign-in failures.</p><p><img src=/images/Blog_P13_021.jpg alt></p><h2 id=ca-004-block-offline-autopilot-devices>CA-004: Block Offline Autopilot Devices</h2><p>This policy addresses a very specific scenario: devices provisioned using <strong>offline Autopilot</strong> profiles. Since Autopilot is a Windows-only capability, the <strong>Device platforms</strong> condition is scoped exclusively to Windows.</p><p>Two conditions are configured in this policy and the Grant control is set to <strong>Block access</strong>. Offline Autopilot enables device provisioning without internet connectivity but the trade-off is that those devices may not receive the latest security policies or configurations during enrollment.</p><p><img src=/images/Blog_P13_026.jpg alt></p><h3 id=device-filter-for-offline-autopilot>Device Filter for Offline Autopilot</h3><p>The core logic of this policy lives in the <strong>Filter for devices</strong> condition. The filter uses the <em>enrollmentProfileName</em> attribute with the <strong>Starts with</strong> operator and the value <em>offline</em>.</p><p>In rule syntax, this appears as:
<em>device.enrollmentProfileName -startsWith &ldquo;offline&rdquo;</em></p><p>This design relies on a simple naming convention. Any Autopilot deployment profile intended for offline use starts with the prefix <em>offline</em>. As a result, only devices enrolled through those profiles are targeted, standard online Autopilot devices are unaffected.</p><p><img src=/images/Blog_P13_027.jpg alt></p><h3 id=ca-004-grant-control>CA-004 Grant Control</h3><p>Like CA-002, this policy uses <strong>Block access</strong> rather than a conditional grant. When a Windows device matches the offline Autopilot filter, access is denied outright, there is no MFA prompt and no compliance evaluation.</p><p>The intent is not to punish the device, but to force it back through a proper <strong>online Autopilot</strong> enrollment, where it can receive current policies, applications and security baselines.</p><p><img src=/images/Blog_P13_028.jpg alt></p><h2 id=creating-terms-of-use>Creating Terms of Use</h2><p>Before CA-005 can enforce Terms of Use, the document itself must exist. In the <strong>New terms of use</strong> workflow, I&rsquo;ve created and uploaded a PDF privacy notice titled <em>Privacy_Notice_Intune_HalfOnCloud.pdf</em>.</p><p>To keep the user experience simple in this lab tenant, I&rsquo;ve disabled:</p><ul><li>Require users to expand the terms of use</li><li>Require users to consent on every device</li></ul><p><strong>Note:</strong> In a production environment these options are often enabled to meet stricter compliance or audit requirements.</p><p><img src=/images/Blog_P13_061.jpg alt></p><h3 id=terms-of-use-management>Terms of Use Management</h3><p>The <strong>Terms of use</strong> blade shows the document <em>Privacy Notice – Intune Device Management</em>. In the details panel, all behavioral options are turned off: users don’t need to expand the document, consent isn’t required per device and consents do not expire.</p><p>At this stage acceptance counters show zero activity. This is expected before the policy is enforced.</p><p><strong>Note:</strong> This is the document referenced later by CA-005.</p><p><img src=/images/Blog_P13_062.jpg alt></p><p><img src=/images/Blog_P13_063.jpg alt></p><h2 id=ca-005-require-terms-of-use>CA-005: Require Terms of Use</h2><p>This policy ensures users acknowledge the Privacy Notice before accessing company resources. In the Grant controls, only <strong>Privacy Notice – Intune Device Management</strong> is selected.</p><p>There are no MFA or device compliance requirements in this policy. Its sole purpose is legal and informational acknowledgement. Because only one control is selected, the <strong>Require one of the selected controls</strong> setting has no practical impact here.</p><p><img src=/images/Blog_P13_033.jpg alt></p><h3 id=the-user-experience>The User Experience</h3><p>When the policy is enforced, users are presented with a Terms of Use prompt. In this case, the Company Portal displays a dialog showing the organization name <em>HalfOnCloud</em> and the user’s identity.</p><p>The message clearly states that access to company resources requires acceptance of the terms. Users must choose <strong>Accept</strong> or <strong>Decline</strong>. Declining immediately blocks access.</p><p><img src=/images/Blog_P13_065.jpg alt></p><h3 id=viewing-the-terms-document>Viewing the Terms Document</h3><p>Expanding the Privacy Notice displays the PDF inline, the document outlines:</p><ul><li>An introduction explaining Intune device management.</li><li>The types of data collected, such as device model, serial number, OS version, installed applications, compliance state, and location.</li><li>How that data is used.</li></ul><p><strong>Note:</strong> This level of transparency is particularly important for EU tenants and supports GDPR notification requirements.</p><p><img src=/images/Blog_P13_066.jpg alt></p><h3 id=terms-of-use-audit-logs>Terms of Use Audit Logs</h3><p>All Terms of Use interactions are recorded in the <strong>Audit logs</strong>. This provides a verifiable record of when users accepted or declined the document, which is essential for compliance and audits:</p><p><img src=/images/Blog_P13_067.jpg alt></p><h3 id=acceptance-tracking>Acceptance Tracking</h3><p>After enforcement the Terms of Use overview reflects real activity. The counters show <strong>Current Accepted: 1</strong> and <strong>Current Declined: 0</strong>. These values update after the next device Sync as users interact with the prompt.</p><p>In larger environments this view becomes a quick health indicator during rollout. If users begin declining the terms, it’s immediately visible and can be investigated.</p><p><img src=/images/Blog_P13_068.jpg alt></p><h2 id=ca-006-block-noncompliant>CA-006-Block-NonCompliant</h2><p><strong>Important note</strong>: In this tenant I only have a single user. I’m on a monthly subscription with one license so I reuse my own account for testing. My account is also a Global Administrator, which means I have to be especially careful with Conditional Access changes. This setup isn’t ideal, but it’s a common reality for lab tenants and personal learning environments and it influenced how this policy was designed and tested.</p><p>This policy ended up being one of the most instructive ones for me, CA-006 uses a <strong>device filter</strong> with two combined conditions:</p><ul><li><em>isCompliant</em> not equal to <em>True</em></li><li><em>trustType</em> equal to <em>Microsoft Entra joined</em></li></ul><p>In rule syntax this translates to:</p><p><em>device.isCompliant -ne True -and device.trustType -eq &ldquo;AzureAD&rdquo;</em></p><p>The intent is very specific: target only devices that are <strong>Entra joined</strong> and <strong>explicitly non-compliant</strong>.</p><p><img src=/images/Blog_P13_041.jpg alt></p><h2 id=why-block-access-instead-of-require-compliance>Why Block Access Instead of Require Compliance</h2><p><strong>Note</strong>: The Grant control is configured as <strong>Block access</strong> not <strong>Require device to be marked as compliant</strong></p><p>Initially, I built this policy using <em>Require compliant device</em> as the Grant control, within minutes, I locked myself out of the tenant.</p><p><img src=/images/Blog_P13_042.jpg alt></p><p>At first I&rsquo;ve excluded my own user from the policy (together with the break-glass account), because this tenant only has one user and I didn’t want to lock myself out. Later I&rsquo;ve temporarily removed my own exclusion just to test the behavior. The policy is intentionally left in <strong>Report-only</strong> mode, in a single-user tenant where the administrator and user are the same person enforcing device compliance offers little practical benefit</p><p>The confusing part is how <strong>Require compliant device</strong> really works.</p><p>When you use <em>Require compliant device</em>, Conditional Access doesn’t just look at the user, it also looks at the <strong>device</strong> trying to sign in. If that device is not enrolled or registered, it has <strong>no compliance status</strong>, Conditional Access treats “no status” the same as <strong>not compliant</strong>.</p><p>That means:</p><ul><li>An unmanaged or unknown device is automatically considered non-compliant.</li><li>Excluding the user does not help because the device check still happens.</li><li>The result is very easy self-lockout especially in lab or single-user tenants.</li></ul><p>Using <strong>Block access</strong> together with a <strong>device filter</strong> works differently.</p><p>The device filter acts like a very strict gate, it only matches devices that are:</p><ul><li>Entra joined.</li><li>And explicitly marked as non-compliant.</li></ul><p>If a device doesn’t meet those exact conditions (for example a home PC that isn’t Entra joined), it doesn’t match the filter at all. When a device doesn’t match the filter, the policy is simply ignored.</p><p>This approach lets me:</p><ul><li>Block access only from known corporate devices that are non-compliant.</li><li>Still manage the tenant from an unmanaged home PC.</li><li>Avoid accidental lockouts while learning and testing.</li></ul><p>I confirmed this using the <strong>What If</strong> tool.<br>With my user excluded, CA-006 appeared under <strong>Policies that will not apply</strong> with the reason <strong>Users and groups</strong>. After temporarily removing my exclusion the same policy moved to <strong>Policies that will apply</strong> showing <strong>Block access</strong> as the result.</p><p>That told me exactly what would have happened if this policy had been enabled without careful exclusions: immediate lockout !</p><p><img src=/images/Blog_P13_052.jpg alt></p><p><img src=/images/Blog_P13_054.jpg alt></p><p><img src=/images/Blog_P13_053.jpg alt></p><h2 id=authentication-strengths>Authentication Strengths</h2><h3 id=custom-authentication-strength-configuration>Custom Authentication Strength Configuration</h3><p>Authentication Strengths allow you to define <strong>exactly which authentication methods</strong> are acceptable for a Conditional Access policy. Instead of allowing any MFA method including easily phishable options such as SMS, you can restrict access to <strong>phishing-resistant methods only</strong>.</p><p>To explore this capability, I&rsquo;ve created a custom authentication strength named <strong>SecInfo-Registration-Secure</strong>. The goal is to address a common chicken-and-egg problem: users need MFA to register MFA.</p><p>This custom strength includes:</p><ul><li>All phishing-resistant methods (Windows Hello for Business, Passkeys, certificate-based authentication)</li><li>Both <strong>Temporary Access Pass (TAP)</strong> variants</li></ul><p>TAP is the critical piece here, it allows users to authenticate securely during initial registration, before any permanent MFA method exists. Without TAP first-time enrollment flows can easily dead-end.</p><p><img src=/images/Blog_P13_069.jpg alt></p><p><img src=/images/Blog_P13_070.jpg alt></p><h3 id=authentication-strength-review-warnings>Authentication Strength Review Warnings</h3><p>The <strong>Review</strong> tab shows which authentication methods are currently registered for my account. The warnings indicate that I’m not yet registered for Passkeys (FIDO2) or certificate-based authentication. These warnings are informational only, they don’t prevent the authentication strength from being created.</p><p>A reminder at the bottom reinforces an important rule: always verify that enforcing an authentication strength won’t lock you out. Since this strength is not applied to any Conditional Access policy yet, its safe to be created:</p><p><img src=/images/Blog_P13_071.jpg alt></p><h3 id=authentication-strengths-overview>Authentication Strengths Overview</h3><p>After creation the <strong>Authentication strengths</strong> blade lists my custom <strong>SecInfo-Registration-Secure</strong> alongside the three built-in strengths. The details panel confirms that five authentication methods are allowed.</p><p>At this stage, the strength is defined but unused. The intended future use is a policy such as <strong>Require secure authentication for security info registration</strong>, ensuring that users can only register or modify MFA methods after authenticating with a strong, phishing-resistant method. This helps prevent attackers from adding their own MFA to a compromised account.</p><p><img src=/images/Blog_P13_072.jpg alt></p><h2 id=why-i-havent-enforced-authentication-strengths-yet>Why I Haven&rsquo;t Enforced Authentication Strengths Yet</h2><p>In a single-user tenant where I am both the administrator and the only user, enforcing phishing-resistant authentication introduces a real lockout risk. My current <strong>CA-001</strong> policy uses the generic <strong>Require MFA</strong> control, which allows Microsoft Authenticator push notifications, a method I have tested and rely on daily.</p><p>Enforcing <strong>Phishing-resistant MFA</strong> would restrict authentication to:</p><ul><li>Windows Hello for Business</li><li>FIDO2 security keys</li><li>Certificate-based authentication</li></ul><p>While Windows Hello works on my virtual machines, I don’t (yet) have a FIDO2 hardware key, and certificate-based authentication would require PKI infrastructure that I haven’t deployed in this tenant.</p><p>For now the authentication strength exists as a <strong>prepared control</strong>. When the environment expands to multiple users, or once I introduce FIDO2 hardware, enforcement can be enabled with confidence knowing the configuration has already been designed and reviewed.</p><hr><h2 id=whats-coming-next>What’s Coming Next</h2><p>This concludes the Conditional Access portion of the series. Up to this point the focus has been on establishing a minimal but coherent identity security baseline using Conditional Access designed to be understandable, auditable and safe to evolve.</p><p>In <strong>Part 6</strong> I’ll shift the focus to <strong>Intune best practices</strong>. That section will cover how device management, compliance and configuration policies complement Conditional Access and where responsibilities should be deliberately separated between identity and device controls.</p></div><footer class=post-footer><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><a href=https://halfoncloud.com/posts/powershell-script-installer-for-win32-part2-m365-apps-and-delivery-optimization/ class="button inline prev">&lt; [<span class=button__text>M365 Apps Deployment with PowerShell Installer & Delivery Optimization Gotchas</span>]
</a>::
<a href=https://halfoncloud.com/posts/powershell-script-for-intune-win32-apps/ class="button inline next">[<span class=button__text>PowerShell script installer for Win32 apps Guide</span>] ></a></div></div></footer></article></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user" style=text-align:center><span>&copy; 2026 Radu Bogdan :: HalfOnCloud</span></div></div></footer><script type=text/javascript src=/bundle.min.js></script><style>.image-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:9999;cursor:pointer;justify-content:center;align-items:center}.image-overlay.active{display:flex}.image-overlay img{max-width:95%;max-height:95%;border:2px solid #fff;object-fit:contain}article img{cursor:pointer}</style><div class=image-overlay id=imageOverlay><img src alt="Enlarged image" id=overlayImage></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("imageOverlay"),t=document.getElementById("overlayImage");document.querySelectorAll("article img").forEach(function(n){n.addEventListener("click",function(){t.src=this.src,e.classList.add("active")})}),e.addEventListener("click",function(){e.classList.remove("active")}),document.addEventListener("keydown",function(t){t.key==="Escape"&&e.classList.remove("active")}),document.querySelectorAll("article pre").forEach(function(e){var t,n=document.createElement("div");n.style.position="relative",e.parentNode.insertBefore(n,e),n.appendChild(e),t=document.createElement("button"),t.textContent="Copy",t.style.cssText="position:absolute; top:5px; right:5px; background:rgba(74,158,255,0.15); color:#4a9eff; border:1px solid rgba(74,158,255,0.3); padding:2px 8px; border-radius:3px; cursor:pointer; font-size:0.7rem; opacity:0.5; transition:opacity 0.2s; z-index:10;",t.addEventListener("mouseenter",function(){t.style.opacity="1"}),t.addEventListener("mouseleave",function(){t.style.opacity="0.7"}),t.addEventListener("click",function(){var n=e.querySelector("code")?e.querySelector("code").textContent:e.textContent;navigator.clipboard.writeText(n).then(function(){t.textContent="Copied!",t.style.background="rgba(34,197,94,0.15)",t.style.color="#22c55e",t.style.borderColor="rgba(34,197,94,0.3)",setTimeout(function(){t.textContent="Copy",t.style.background="rgba(74,158,255,0.15)",t.style.color="#4a9eff",t.style.borderColor="rgba(74,158,255,0.3)"},2e3)})}),n.appendChild(t)})})</script><script>(function(){let n=null;const t=document.getElementById("search-input"),e=document.getElementById("search-results");if(!t||!e)return;fetch("/index.json").then(e=>e.json()).then(e=>{n=e}).catch(e=>console.log("Search index not found"));function o(e,t){let n;return function(...s){clearTimeout(n),n=setTimeout(()=>e.apply(this,s),t)}}function s(t){if(!n||t.length<2){e.innerHTML="";return}const s=n.filter(e=>{const n=(e.title+" "+e.contents+" "+(e.tags||[]).join(" ")).toLowerCase();return n.includes(t.toLowerCase())}).slice(0,8);if(s.length===0){e.innerHTML='<div class="search-no-results">No results found</div>';return}e.innerHTML=s.map(e=>{const o=e.contents.toLowerCase(),i=t.toLowerCase();let n="";const s=o.indexOf(i);if(s!==-1){const o=Math.max(0,s-40),i=Math.min(e.contents.length,s+t.length+60);n=(o>0?"...":"")+e.contents.substring(o,i)+(i<e.contents.length?"...":"")}else n=e.contents.substring(0,100)+"...";return`
                <div class="search-result-item">
                    <a href="${e.permalink}">${e.title}</a>
                    <div class="search-date">${e.date}</div>
                    <div class="search-snippet">${n}</div>
                </div>
            `}).join("")}t.addEventListener("input",o(function(e){s(e.target.value.trim())},300)),document.addEventListener("click",function(n){!t.contains(n.target)&&!e.contains(n.target)&&(e.innerHTML="")}),t.addEventListener("focus",function(){this.value.length>=2&&s(this.value.trim())})})()</script></div></body></html>