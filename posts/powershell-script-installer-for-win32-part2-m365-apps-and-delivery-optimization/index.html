<!doctype html><html lang=en><head><title>M365 Apps Deployment with PowerShell Installer & Delivery Optimization Gotchas :: HalfOnCloud</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Part 2 of my PowerShell Win32 Apps guide: M365 Apps deployment and how to handle Delivery Optimization settings"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://halfoncloud.com/posts/powershell-script-installer-for-win32-part2-m365-apps-and-delivery-optimization/><link rel=stylesheet href=https://halfoncloud.com/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://halfoncloud.com/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://halfoncloud.com/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://halfoncloud.com/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://halfoncloud.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://halfoncloud.com/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://halfoncloud.com/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://halfoncloud.com/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://halfoncloud.com/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://halfoncloud.com/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://halfoncloud.com/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://halfoncloud.com/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://halfoncloud.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://halfoncloud.com/style.css><link rel="shortcut icon" href=https://halfoncloud.com/favicon.png><link rel=apple-touch-icon href=https://halfoncloud.com/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="M365 Apps Deployment with PowerShell Installer & Delivery Optimization Gotchas"><meta property="og:description" content="Part 2 of my PowerShell Win32 Apps guide: M365 Apps deployment and how to handle Delivery Optimization settings"><meta property="og:url" content="https://halfoncloud.com/posts/powershell-script-installer-for-win32-part2-m365-apps-and-delivery-optimization/"><meta property="og:site_name" content="HalfOnCloud"><meta property="og:image" content="https://halfoncloud.com/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="#MSIntune "><meta property="article:section" content="#PowerShell"><meta property="article:section" content="#Win32 "><meta property="article:section" content="#M365Apps"><meta property="article:section" content="#DeliveryOptimization"><meta property="article:published_time" content="2026-01-23 00:00:00 +0000 UTC"><style>body{font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,sans-serif!important;font-size:1.05rem!important}h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,sans-serif!important;font-weight:700!important}article h1,article h2,article h3,article.post h1,article.post h2,article.post h3,.content h1,.content h2,.content h3{color:#4a9eff!important;border-bottom:none!important}article.post .post-title{color:#4a9eff!important;border-bottom:none!important}article.post .post-title a{color:#4a9eff!important}.logo{background:0 0!important;padding-left:0!important;margin-left:0!important}.header__logo::after{margin-left:10px;background:repeating-linear-gradient(90deg,#4a9eff,#4a9eff 2px,transparent 0,transparent 10px)!important}img{border:none!important}article a,.post-content a{color:#4a9eff!important}article a:hover,.post-content a:hover{color:#6bb3ff!important}body,html{background-color:#1a1d2e!important}.header{margin-bottom:30px!important}.post.on-list{background:#363636;padding:20px;margin-bottom:20px;border-radius:8px}.post-title a{font-size:1.4rem!important;color:#4a9eff!important}.post-title{border-bottom:none!important;padding-bottom:0!important}.post-title::after,h1::after,h2::after,h3::after{display:none!important}.post-tags{color:#4a9eff!important}.post-tags a{color:#4a9eff!important}.post-tags a:hover{color:#6bb0ff!important}.navigation-menu a{color:#4a9eff!important}.navigation-menu a:hover{color:#6bb0ff!important}.menu__trigger{color:#4a9eff!important;border:2px solid #4a9eff!important;background-color:transparent!important}.menu__dropdown{background-color:#363636!important;border:2px solid #4a9eff!important}.menu__dropdown a{color:#4a9eff!important}.menu__dropdown a:hover{color:#6bb0ff!important;background-color:#404040!important}.read-more.button{display:inline-block!important;background-color:#4a9eff!important;color:#fff!important;padding:8px 18px!important;border-radius:28px!important;text-decoration:none!important;font-weight:600!important;transition:all .3s ease!important;border:none!important;font-size:0!important}.read-more.button::after{content:"Read More →"!important;font-size:.99rem!important;display:inline-block}.read-more.button:hover{background-color:#6bb0ff!important;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.2)}article ul,.post-content ul{list-style:none!important}article ul li,.post-content ul li{position:relative!important;padding-left:1.2em!important}article ul li::before,.post-content ul li::before{content:"●"!important;position:absolute!important;left:0!important;color:#4a9eff!important;font-weight:700!important}article ul ul li::before,.post-content ul ul li::before{content:"○"!important;color:#4a9eff!important}.sidebar-left ul li::before,.sidebar-right ul li::before,.sidebar-nav ul li::before,.widget-list li::before{content:none!important;display:none!important}.sidebar-left ul li,.sidebar-right ul li,.sidebar-nav ul li,.widget-list li{padding-left:0!important}.heading-link,.anchor,.zola-anchor,h1 a.anchor,h2 a.anchor,h3 a.anchor,h1>a[href^="#"],h2>a[href^="#"],h3>a[href^="#"]{display:none!important;visibility:hidden!important}.sidebar-nav a{font-weight:700!important}.sidebar-title{font-size:1.8rem!important}body.three-column-layout{display:flex;min-height:100vh;margin:0;padding:0}.sidebar-left{width:250px;min-width:250px;background-color:#13151f;border-right:1px solid #2a2d3e;position:fixed;left:0;top:0;height:100vh;overflow-y:auto;z-index:100}.sidebar-left__inner{padding:30px 20px;display:flex;flex-direction:column;align-items:center}.sidebar-avatar{margin-bottom:15px}.avatar-img{width:120px;height:120px;border-radius:50%;object-fit:cover;border:3px solid #4a9eff}.avatar-placeholder{width:120px;height:120px;border-radius:50%;background:linear-gradient(135deg,#4a9eff 0%,#6bb0ff 100%);display:flex;align-items:center;justify-content:center;font-size:3rem;font-weight:700;color:#fff}.sidebar-title{font-size:1.5rem;margin:10px 0 5px;text-align:center}.sidebar-title a{color:#fff;text-decoration:none}.sidebar-title .red{color:#f44}.sidebar-tagline{font-size:.85rem;color:#888;text-align:center;margin:0 0 25px;line-height:1.4}.sidebar-nav ul{list-style:none;padding:0;margin:0;width:100%}.sidebar-nav li{margin:5px 0}.sidebar-nav a{display:flex;align-items:center;gap:12px;padding:12px 20px;color:#ccc;text-decoration:none;border-radius:8px;transition:all .2s ease;font-size:.95rem}.sidebar-nav a:hover{background-color:#2a2d3e;color:#4a9eff}.sidebar-nav li.active a{background-color:#4a9eff;color:#fff}.sidebar-nav svg{flex-shrink:0}.main-wrapper{flex:1;margin-left:250px;margin-right:280px;min-height:100vh;padding:30px 40px;max-width:950px}.sidebar-right{width:280px;min-width:280px;background-color:#151822;border-left:1px solid #2a2d3e;position:fixed;right:0;top:0;height:100vh;overflow-y:auto;z-index:100}.sidebar-right__inner{padding:30px 20px}.widget{margin-bottom:30px}.widget-title{font-size:1rem;color:#fff;margin:0 0 15px;padding-bottom:10px;border-bottom:1px solid #2a2d3e}.widget-list{list-style:none;padding:0;margin:0}.widget-list li{margin:8px 0}.widget-list a{color:#ccc;text-decoration:none;font-size:.9rem;display:block;padding:5px 0;transition:color .2s ease}.widget-list a:hover{color:#4a9eff}.widget-tags{display:flex;flex-wrap:wrap;gap:8px}.widget-tag{display:inline-block;padding:5px 12px;background-color:#2a2d3e;color:#ccc;text-decoration:none;border-radius:15px;font-size:.8rem;transition:all .2s ease}.widget-tag:hover{background-color:#4a9eff;color:#fff}.widget-tag .count{margin-left:5px;opacity:.7}.archives h1{color:#4a9eff;margin-bottom:30px}.archive-year h2{color:#4a9eff;font-size:1.3rem;margin:25px 0 15px;padding-left:10px;border-left:3px solid #4a9eff}.archive-posts{list-style:none;padding:0;margin:0}.archive-posts li{padding:8px 0;display:flex;align-items:center;gap:15px}.archive-date{color:#888;font-size:.85rem;min-width:60px}.archive-posts a{color:#ccc;text-decoration:none}.archive-posts a:hover{color:#4a9eff}body.three-column-layout .header{display:none}@media(max-width:1200px){.sidebar-right{display:none}.main-wrapper{margin-right:0}}@media(max-width:768px){body.three-column-layout{flex-direction:column}.sidebar-left{width:100%;min-width:100%;position:relative;height:auto;border-right:none;border-bottom:1px solid #2a2d3e}.sidebar-left__inner{padding:20px;height:auto}.sidebar-nav ul{display:flex;flex-wrap:wrap;justify-content:center;gap:5px}.sidebar-nav a{padding:8px 15px}.avatar-img,.avatar-placeholder{width:80px;height:80px;font-size:2rem}.main-wrapper{margin-left:0;padding:20px}.sidebar-right{display:none}.sidebar-social{position:relative;bottom:auto;margin-top:15px}}@media(max-width:768px){.sidebar-social{position:relative!important;bottom:auto!important;width:100%!important;margin-top:20px!important;padding-top:15px!important;border-top:1px solid #2a2d3e}.sidebar-nav ul{width:100%}}@media(max-width:768px){.main-wrapper{overflow-x:hidden!important;max-width:100vw!important}article img,.post-content img,.content img{max-width:100%!important;height:auto!important}pre,code{max-width:100%!important;overflow-x:auto!important;white-space:pre-wrap!important;word-wrap:break-word!important}.post-title,article h1,article h2{word-wrap:break-word!important;overflow-wrap:break-word!important}}.search-widget{margin-bottom:25px}.search-box{position:relative;display:flex;align-items:center}.search-icon{position:absolute;left:12px;color:#888;pointer-events:none}#search-input{width:100%;padding:12px 15px 12px 40px;background-color:#2a2d3e;border:1px solid #3a3d4e;border-radius:8px;color:#fff;font-size:.9rem;outline:none;transition:all .2s ease}#search-input:focus{border-color:#4a9eff;box-shadow:0 0 0 3px rgba(74,158,255,.2)}#search-input::placeholder{color:#666}#search-results{margin-top:10px;max-height:400px;overflow-y:auto}#search-results:empty{display:none}.search-result-item{padding:10px;margin:5px 0;background-color:#2a2d3e;border-radius:6px;transition:background-color .2s ease}.search-result-item:hover{background-color:#3a3d4e}.search-result-item a{color:#4a9eff;text-decoration:none;font-size:.9rem;display:block}.search-result-item .search-date{font-size:.75rem;color:#888;margin-top:3px}.search-result-item .search-snippet{font-size:.8rem;color:#aaa;margin-top:5px;line-height:1.4}.search-no-results{color:#888;font-size:.85rem;padding:10px;text-align:center}.post-featured-image{margin:20px 0 30px;border-radius:8px;overflow:hidden}.post-featured-image img{width:100%;height:auto;display:block}.terms h1{color:#4a9eff!important;margin-bottom:20px}.terms ul{list-style:none!important;padding:0;margin:0}.terms li{margin:12px 0;display:flex;align-items:center;gap:10px}.terms li::before{display:none!important;content:none!important}.terms li svg{color:#4a9eff!important;flex-shrink:0}.terms a,.terms li a,.terms ul li a{color:#4a9eff!important;text-decoration:none!important;font-size:1.1rem;transition:color .2s ease}.terms a:hover,.terms li a:hover,.terms ul li a:hover{color:#6bb0ff!important}.main-wrapper{margin:0 auto!important}.avatar-img{width:300px!important;height:auto!important;border-radius:20px!important;object-fit:contain!important}.sidebar-social{display:flex;gap:15px;justify-content:center;position:absolute;bottom:30px;left:0;right:0}.sidebar-social a{color:#888;transition:color .2s ease}.sidebar-social a:hover{color:#4a9eff}</style></head><body class=three-column-layout><aside class=sidebar-left><div class=sidebar-left__inner><div class=sidebar-avatar><a href=https://halfoncloud.com/><img src=/images/avatar.png alt=HalfOnCloud class=avatar-img></a></div><h2 class=sidebar-title><a href=https://halfoncloud.com/>Half<span class=red>On</span>Cloud</a></h2><p class=sidebar-tagline>IT tutorials, automation scripts, and real-world solutions</p><nav class=sidebar-nav><ul><li><a href=https://halfoncloud.com/><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
Home</a></li><li><a href=https://halfoncloud.com/categories/><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
Categories</a></li><li><a href=https://halfoncloud.com/tags/><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
Tags</a></li><li><a href=https://halfoncloud.com/archives/><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
Archives</a></li><li><a href=https://halfoncloud.com/about/><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
About</a></li></ul></nav><div class=sidebar-social><a href=https://x.com/HeyRadu target=_blank rel=noopener title=X/Twitter><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
</a><a href=https://linkedin.com/in/radu-bogdan target=_blank rel=noopener title=LinkedIn><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg></a></div></div></aside><aside class=sidebar-right><div class=sidebar-right__inner><div class="widget search-widget"><div class=search-box><svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
<input type=text id=search-input placeholder=Search... autocomplete=off></div><div id=search-results></div></div><div class=widget><h3 class=widget-title>Recent Posts</h3><ul class=widget-list><li><a href=https://halfoncloud.com/posts/powershell-script-installer-for-win32-part2-m365-apps-and-delivery-optimization/>M365 Apps Deployment with PowerShell Installer & Delivery Optimization Gotchas</a></li><li><a href=https://halfoncloud.com/posts/m365-business-premium-part-5-intune-conditional-access-policies/>M365 Business Premium Part 5: Conditional Access Policies</a></li><li><a href=https://halfoncloud.com/posts/powershell-script-for-intune-win32-apps/>PowerShell script installer for Win32 apps Guide</a></li><li><a href=https://halfoncloud.com/posts/microsoft-intune-declarative-device-management-ddm/>Microsoft Intune Declarative Device Management (DDM) Guide</a></li><li><a href=https://halfoncloud.com/posts/m365-business-premium-part-4-intune-naming-conventions-and-standards/>M365 Business Premium Part 4: Naming Conventions and Standards</a></li></ul></div><div class=widget><h3 class=widget-title>Categories</h3><div class=widget-tags><a href=https://halfoncloud.com/categories/%23deliveryoptimization/ class=widget-tag>#DeliveryOptimization <span class=count>1</span>
</a><a href=https://halfoncloud.com/categories/%23m365apps/ class=widget-tag>#M365Apps <span class=count>1</span>
</a><a href=https://halfoncloud.com/categories/%23msintune/ class=widget-tag>#MSIntune  <span class=count>1</span>
</a><a href=https://halfoncloud.com/categories/%23powershell/ class=widget-tag>#PowerShell <span class=count>1</span>
</a><a href=https://halfoncloud.com/categories/%23win32/ class=widget-tag>#Win32  <span class=count>1</span>
</a><a href=https://halfoncloud.com/categories/cloud/ class=widget-tag>Cloud <span class=count>8</span>
</a><a href=https://halfoncloud.com/categories/general/ class=widget-tag>General <span class=count>1</span></a></div></div><div class=widget><h3 class=widget-title>Tags</h3><div class=widget-tags><a href=https://halfoncloud.com/tags/about/ class=widget-tag>About <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/ddm/ class=widget-tag>DDM <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/entraid/ class=widget-tag>EntraID <span class=count>4</span>
</a><a href=https://halfoncloud.com/tags/licensing/ class=widget-tag>Licensing <span class=count>3</span>
</a><a href=https://halfoncloud.com/tags/m365/ class=widget-tag>M365 <span class=count>5</span>
</a><a href=https://halfoncloud.com/tags/mmp-c/ class=widget-tag>MMP-C <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/msintune/ class=widget-tag>MSIntune <span class=count>9</span>
</a><a href=https://halfoncloud.com/tags/powershell/ class=widget-tag>PowerShell <span class=count>2</span>
</a><a href=https://halfoncloud.com/tags/security/ class=widget-tag>Security <span class=count>1</span>
</a><a href=https://halfoncloud.com/tags/win32/ class=widget-tag>Win32 <span class=count>2</span>
</a><a href=https://halfoncloud.com/tags/windc/ class=widget-tag>WinDC <span class=count>1</span></a></div></div></div></aside><div class=main-wrapper><div class=content><article class=post><header class=post-header><h1 class=post-title>M365 Apps Deployment with PowerShell Installer & Delivery Optimization Gotchas</h1><div class=post-meta><time class=post-date>2026-01-23</time>
<span class=post-author>Radu Bogdan</span></div><span class=post-tags>#<a href=https://halfoncloud.com/tags/msintune/>MSIntune</a>&nbsp;
#<a href=https://halfoncloud.com/tags/powershell/>PowerShell</a>&nbsp;
#<a href=https://halfoncloud.com/tags/win32/>Win32</a>&nbsp;</span></header><div class=post-content><h2 id=building-on-the-foundation>Building on the Foundation</h2><p>In my previous article, <em>PowerShell script installer for Win32 apps Guide</em> I&rsquo;ve demonstrated Microsoft’s new native PowerShell installer type for Win32 apps using a simple 7-Zip MSI deployment. That approach removed the need to repackage applications just to adjust install logic, a meaningful improvement to the Win32 app workflow in Intune.</p><p>However, 7-Zip is a small self-contained installer, the real test comes when applying this same approach to a much more complex scenario: an application that downloads several gigabytes of content from a CDN during installation.</p><p>This article takes the PowerShell installer model to the next level with <strong>Microsoft 365 Apps</strong>, an evergreen deployment that pulls the latest Monthly Enterprise Channel build directly from Microsoft’s CDN. Along the way I&rsquo;ve discovered that my existing Delivery Optimization (DO) policy was also actively interfering with the install, silently throttling download speed and turning what should have been a ~15–20 minute deployment into a multi-hour experience.</p><h3 id=what-this-article-covers>What This Article Covers</h3><p>This deployment combines several moving parts: the Office Deployment Tool with a CDN-based configuration, a couple PowerShell scripts for install & uninstall as well as a separate custom detection logic with detailed logging and critically the Delivery Optimization settings that can make or break large app deployments during either regular installations (or Autopilot deployments).</p><p>I’ll walk through the complete package structure, Intune configuration and real-world troubleshooting using IME logs and PowerShell transcripts. The before/after comparison clearly shows how much bandwidth my original DO policy was leaving unused and why this matters for both regular deployments and Autopilot scenarios.</p><h3 id=m365-apps-package-root-folder-structure>M365 Apps Package Root Folder Structure</h3><p>The root folder of the new M365 Apps Win32 package contains five items:</p><ul><li>Two folders:<ul><li><strong>Source</strong> (original installation files)</li><li><strong>Output</strong> (for the generated <em>.intunewin</em> file)</li></ul></li><li>Three PowerShell scripts:<ul><li><em>Install-M365Apps.ps1</em></li><li><em>Uninstall-M365Apps.ps1</em></li><li><em>M365AppsWin32DetectionScript.ps1</em></li></ul></li></ul><p><img src=/images/Blog_P14_010.jpg alt></p><h3 id=m365-apps-source-folder-contents>M365 Apps Source Folder Contents</h3><p>The <em>Source</em> folder contains only three files totaling approximately ~7 MB:</p><ul><li><em>M365Apps.xml</em> - Office Deployment Tool configuration</li><li><em>remove.xml</em> - uninstallation configuration</li><li><em>setup.exe</em> - Office Deployment Tool executable</li></ul><h4 id=office-deployment-tool>Office Deployment Tool</h4><p>Version: 16.0.19628.20046<br>Date published: 2026-01-15</p><p>Source: <a href="https://www.microsoft.com/en-us/download/details.aspx?id=49117">https://www.microsoft.com/en-us/download/details.aspx?id=49117</a></p><p><img src=/images/Blog_P14_072.jpg alt></p><h3 id=what-each-files-contains>What each files contains:</h3><p><strong>M365Apps.xml</strong></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-XML data-lang=XML><span style=display:flex><span><span style=color:#6ab825;font-weight:700>&lt;Configuration&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;Add</span> <span style=color:#bbb>OfficeClientEdition=</span><span style=color:#ed9d13>&#34;64&#34;</span> <span style=color:#bbb>Channel=</span><span style=color:#ed9d13>&#34;Current&#34;</span><span style=color:#6ab825;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>&lt;Product</span> <span style=color:#bbb>ID=</span><span style=color:#ed9d13>&#34;O365BusinessRetail&#34;</span><span style=color:#6ab825;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:#6ab825;font-weight:700>&lt;Language</span> <span style=color:#bbb>ID=</span><span style=color:#ed9d13>&#34;en-us&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>&lt;ExcludeApp</span> <span style=color:#bbb>ID=</span><span style=color:#ed9d13>&#34;Groove&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>&lt;ExcludeApp</span> <span style=color:#bbb>ID=</span><span style=color:#ed9d13>&#34;Lync&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>&lt;ExcludeApp</span> <span style=color:#bbb>ID=</span><span style=color:#ed9d13>&#34;Bing&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>&lt;/Product&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;/Add&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;Property</span> <span style=color:#bbb>Name=</span><span style=color:#ed9d13>&#34;SharedComputerLicensing&#34;</span> <span style=color:#bbb>Value=</span><span style=color:#ed9d13>&#34;0&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;Property</span> <span style=color:#bbb>Name=</span><span style=color:#ed9d13>&#34;FORCEAPPSHUTDOWN&#34;</span> <span style=color:#bbb>Value=</span><span style=color:#ed9d13>&#34;TRUE&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;Property</span> <span style=color:#bbb>Name=</span><span style=color:#ed9d13>&#34;DeviceBasedLicensing&#34;</span> <span style=color:#bbb>Value=</span><span style=color:#ed9d13>&#34;0&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;Property</span> <span style=color:#bbb>Name=</span><span style=color:#ed9d13>&#34;SCLCacheOverride&#34;</span> <span style=color:#bbb>Value=</span><span style=color:#ed9d13>&#34;0&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;Updates</span> <span style=color:#bbb>Enabled=</span><span style=color:#ed9d13>&#34;TRUE&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;AppSettings&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>&lt;User</span> <span style=color:#bbb>Key=</span><span style=color:#ed9d13>&#34;software\microsoft\office\16.0\excel\options&#34;</span> <span style=color:#bbb>Name=</span><span style=color:#ed9d13>&#34;defaultformat&#34;</span> <span style=color:#bbb>Value=</span><span style=color:#ed9d13>&#34;51&#34;</span> <span style=color:#bbb>Type=</span><span style=color:#ed9d13>&#34;REG_DWORD&#34;</span> <span style=color:#bbb>App=</span><span style=color:#ed9d13>&#34;excel16&#34;</span> <span style=color:#bbb>Id=</span><span style=color:#ed9d13>&#34;L_SaveExcelfilesas&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>&lt;User</span> <span style=color:#bbb>Key=</span><span style=color:#ed9d13>&#34;software\microsoft\office\16.0\powerpoint\options&#34;</span> <span style=color:#bbb>Name=</span><span style=color:#ed9d13>&#34;defaultformat&#34;</span> <span style=color:#bbb>Value=</span><span style=color:#ed9d13>&#34;27&#34;</span> <span style=color:#bbb>Type=</span><span style=color:#ed9d13>&#34;REG_DWORD&#34;</span> <span style=color:#bbb>App=</span><span style=color:#ed9d13>&#34;ppt16&#34;</span> <span style=color:#bbb>Id=</span><span style=color:#ed9d13>&#34;L_SavePowerPointfilesas&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>&lt;User</span> <span style=color:#bbb>Key=</span><span style=color:#ed9d13>&#34;software\microsoft\office\16.0\word\options&#34;</span> <span style=color:#bbb>Name=</span><span style=color:#ed9d13>&#34;defaultformat&#34;</span> <span style=color:#bbb>Value=</span><span style=color:#ed9d13>&#34;&#34;</span> <span style=color:#bbb>Type=</span><span style=color:#ed9d13>&#34;REG_SZ&#34;</span> <span style=color:#bbb>App=</span><span style=color:#ed9d13>&#34;word16&#34;</span> <span style=color:#bbb>Id=</span><span style=color:#ed9d13>&#34;L_SaveWordfilesas&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>&lt;Setup</span> <span style=color:#bbb>Name=</span><span style=color:#ed9d13>&#34;Company&#34;</span> <span style=color:#bbb>Value=</span><span style=color:#ed9d13>&#34;HalfOnCloud&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;/AppSettings&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;Display</span> <span style=color:#bbb>Level=</span><span style=color:#ed9d13>&#34;None&#34;</span> <span style=color:#bbb>AcceptEULA=</span><span style=color:#ed9d13>&#34;TRUE&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;Logging</span> <span style=color:#bbb>Level=</span><span style=color:#ed9d13>&#34;Standard&#34;</span> <span style=color:#bbb>Path=</span><span style=color:#ed9d13>&#34;%WinDir%\Logs\Software\M365AppsProPlus\&#34;</span> <span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>&lt;/Configuration&gt;</span>
</span></span></code></pre></div><p><strong>remove.xml</strong></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-XML data-lang=XML><span style=display:flex><span><span style=color:#6ab825;font-weight:700>&lt;Configuration&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;Display</span> <span style=color:#bbb>Level=</span><span style=color:#ed9d13>&#34;None&#34;</span> <span style=color:#bbb>AcceptEULA=</span><span style=color:#ed9d13>&#34;True&#34;</span><span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;Property</span> <span style=color:#bbb>Name=</span><span style=color:#ed9d13>&#34;FORCEAPPSHUTDOWN&#34;</span> <span style=color:#bbb>Value=</span><span style=color:#ed9d13>&#34;True&#34;</span><span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;Remove&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>&lt;Product</span> <span style=color:#bbb>ID=</span><span style=color:#ed9d13>&#34;O365BusinessRetail&#34;</span><span style=color:#6ab825;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>&lt;Language</span> <span style=color:#bbb>ID=</span><span style=color:#ed9d13>&#34;en-us&#34;</span><span style=color:#6ab825;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>&lt;/Product&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>&lt;/Remove&gt;</span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>&lt;/Configuration&gt;</span>
</span></span></code></pre></div><p><strong>Install-M365Apps.ps1</strong></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span><span style=color:#999;font-style:italic># Variables</span>
</span></span><span style=display:flex><span><span style=color:#40ffff>$PackageName</span> = <span style=color:#ed9d13>&#34;M365Apps-Current&#34;</span>
</span></span><span style=display:flex><span><span style=color:#40ffff>$LogPath</span> = <span style=color:#ed9d13>&#34;</span><span style=color:#40ffff>$env:ProgramData</span><span style=color:#ed9d13>\Microsoft\IntuneManagementExtension\Logs&#34;</span>
</span></span><span style=display:flex><span><span style=color:#40ffff>$SetupFile</span> = <span style=color:#ed9d13>&#34;</span><span style=color:#40ffff>$PSScriptRoot</span><span style=color:#ed9d13>\setup.exe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#40ffff>$ConfigFile</span> = <span style=color:#ed9d13>&#34;</span><span style=color:#40ffff>$PSScriptRoot</span><span style=color:#ed9d13>\M365Apps.xml&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># Start logging</span>
</span></span><span style=display:flex><span><span style=color:#24909d>Start-Transcript</span> -Path <span style=color:#ed9d13>&#34;</span><span style=color:#40ffff>$LogPath</span><span style=color:#ed9d13>\</span><span style=color:#40ffff>$PackageName</span><span style=color:#ed9d13>-install.log&#34;</span> -Force -Append
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Starting installation of </span><span style=color:#40ffff>$PackageName</span><span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Setup Path: </span><span style=color:#40ffff>$SetupFile</span><span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Config Path: </span><span style=color:#40ffff>$ConfigFile</span><span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Timestamp: </span>$(<span style=color:#24909d>Get-Date</span> -Format <span style=color:#ed9d13>&#39;yyyy-MM-dd HH:mm:ss&#39;</span>)<span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#999;font-style:italic># Verify files exist</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>if</span> (!(<span style=color:#24909d>Test-Path</span> <span style=color:#40ffff>$SetupFile</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;ERROR: setup.exe not found!&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#24909d>Stop-Transcript</span>
</span></span><span style=display:flex><span>        exit <span style=color:#3677a9>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>if</span> (!(<span style=color:#24909d>Test-Path</span> <span style=color:#40ffff>$ConfigFile</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;ERROR: M365Apps.xml not found!&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#24909d>Stop-Transcript</span>
</span></span><span style=display:flex><span>        exit <span style=color:#3677a9>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#999;font-style:italic># Install</span>
</span></span><span style=display:flex><span>    <span style=color:#40ffff>$arguments</span> = <span style=color:#ed9d13>&#34;/configure </span><span style=color:#ed9d13>`&#34;</span><span style=color:#40ffff>$ConfigFile</span><span style=color:#ed9d13>`&#34;</span><span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Running: </span><span style=color:#40ffff>$SetupFile</span><span style=color:#ed9d13> </span><span style=color:#40ffff>$arguments</span><span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#40ffff>$process</span> = <span style=color:#24909d>Start-Process</span> -FilePath <span style=color:#40ffff>$SetupFile</span> -ArgumentList <span style=color:#40ffff>$arguments</span> -Wait -PassThru
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Exit code: </span>$(<span style=color:#40ffff>$process</span>.ExitCode)<span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Stop-Transcript</span>
</span></span><span style=display:flex><span>    exit <span style=color:#40ffff>$process</span>.ExitCode
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>catch</span> {
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;ERROR: </span>$(<span style=color:#40ffff>$_</span>.Exception.Message)<span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Stop-Transcript</span>
</span></span><span style=display:flex><span>    exit <span style=color:#3677a9>1</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Uninstall-M365Apps.ps1</strong></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span><span style=color:#999;font-style:italic># Variables</span>
</span></span><span style=display:flex><span><span style=color:#40ffff>$PackageName</span> = <span style=color:#ed9d13>&#34;M365Apps-Current&#34;</span>
</span></span><span style=display:flex><span><span style=color:#40ffff>$LogPath</span> = <span style=color:#ed9d13>&#34;</span><span style=color:#40ffff>$env:ProgramData</span><span style=color:#ed9d13>\Microsoft\IntuneManagementExtension\Logs&#34;</span>
</span></span><span style=display:flex><span><span style=color:#40ffff>$SetupFile</span> = <span style=color:#ed9d13>&#34;</span><span style=color:#40ffff>$PSScriptRoot</span><span style=color:#ed9d13>\setup.exe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#40ffff>$RemoveFile</span> = <span style=color:#ed9d13>&#34;</span><span style=color:#40ffff>$PSScriptRoot</span><span style=color:#ed9d13>\remove.xml&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># Start logging</span>
</span></span><span style=display:flex><span><span style=color:#24909d>Start-Transcript</span> -Path <span style=color:#ed9d13>&#34;</span><span style=color:#40ffff>$LogPath</span><span style=color:#ed9d13>\</span><span style=color:#40ffff>$PackageName</span><span style=color:#ed9d13>-uninstall.log&#34;</span> -Force -Append
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Starting uninstallation of </span><span style=color:#40ffff>$PackageName</span><span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Setup Path: </span><span style=color:#40ffff>$SetupFile</span><span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Remove Config Path: </span><span style=color:#40ffff>$RemoveFile</span><span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Timestamp: </span>$(<span style=color:#24909d>Get-Date</span> -Format <span style=color:#ed9d13>&#39;yyyy-MM-dd HH:mm:ss&#39;</span>)<span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#999;font-style:italic># Verify files exist</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>if</span> (!(<span style=color:#24909d>Test-Path</span> <span style=color:#40ffff>$SetupFile</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;ERROR: setup.exe not found!&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#24909d>Stop-Transcript</span>
</span></span><span style=display:flex><span>        exit <span style=color:#3677a9>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>if</span> (!(<span style=color:#24909d>Test-Path</span> <span style=color:#40ffff>$RemoveFile</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;ERROR: remove.xml not found!&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#24909d>Stop-Transcript</span>
</span></span><span style=display:flex><span>        exit <span style=color:#3677a9>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#999;font-style:italic># Uninstall</span>
</span></span><span style=display:flex><span>    <span style=color:#40ffff>$arguments</span> = <span style=color:#ed9d13>&#34;/configure </span><span style=color:#ed9d13>`&#34;</span><span style=color:#40ffff>$RemoveFile</span><span style=color:#ed9d13>`&#34;</span><span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Running: </span><span style=color:#40ffff>$SetupFile</span><span style=color:#ed9d13> </span><span style=color:#40ffff>$arguments</span><span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#40ffff>$process</span> = <span style=color:#24909d>Start-Process</span> -FilePath <span style=color:#40ffff>$SetupFile</span> -ArgumentList <span style=color:#40ffff>$arguments</span> -Wait -PassThru
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Exit code: </span>$(<span style=color:#40ffff>$process</span>.ExitCode)<span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Stop-Transcript</span>
</span></span><span style=display:flex><span>    exit <span style=color:#40ffff>$process</span>.ExitCode
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>catch</span> {
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;ERROR: </span>$(<span style=color:#40ffff>$_</span>.Exception.Message)<span style=color:#ed9d13>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Stop-Transcript</span>
</span></span><span style=display:flex><span>    exit <span style=color:#3677a9>1</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>M365AppsWin32DetectionScript.ps1</strong></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span><span style=color:#999;font-style:italic># Detection Script for M365 Apps</span>
</span></span><span style=display:flex><span><span style=color:#40ffff>$LogPath</span> = <span style=color:#ed9d13>&#34;</span><span style=color:#40ffff>$env:ProgramData</span><span style=color:#ed9d13>\Microsoft\IntuneManagementExtension\Logs&#34;</span>
</span></span><span style=display:flex><span><span style=color:#40ffff>$LogFile</span> = <span style=color:#ed9d13>&#34;</span><span style=color:#40ffff>$LogPath</span><span style=color:#ed9d13>\M365Apps-Detection.log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># Start logging</span>
</span></span><span style=display:flex><span><span style=color:#ed9d13>&#34;</span>$(<span style=color:#24909d>Get-Date</span> -Format <span style=color:#ed9d13>&#39;yyyy-MM-dd HH:mm:ss&#39;</span>)<span style=color:#ed9d13> - Starting M365 Apps detection&#34;</span> | <span style=color:#24909d>Out-File</span> -FilePath <span style=color:#40ffff>$LogFile</span> -Force
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># Check for Microsoft 365 Apps in uninstall registry</span>
</span></span><span style=display:flex><span><span style=color:#40ffff>$M365Apps</span> = <span style=color:#24909d>Get-ChildItem</span> -Path <span style=color:#ed9d13>&#34;HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall&#34;</span> | 
</span></span><span style=display:flex><span>    <span style=color:#24909d>Get-ItemProperty</span> | 
</span></span><span style=display:flex><span>    <span style=color:#24909d>Where-Object</span> { <span style=color:#40ffff>$_</span>.DisplayName -match <span style=color:#ed9d13>&#34;Microsoft 365&#34;</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>if</span> (<span style=color:#40ffff>$M365Apps</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ed9d13>&#34;</span>$(<span style=color:#24909d>Get-Date</span> -Format <span style=color:#ed9d13>&#39;yyyy-MM-dd HH:mm:ss&#39;</span>)<span style=color:#ed9d13> - Detected: </span>$(<span style=color:#40ffff>$M365Apps</span>.DisplayName)<span style=color:#ed9d13>&#34;</span> | <span style=color:#24909d>Out-File</span> -FilePath <span style=color:#40ffff>$LogFile</span> -Append
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Output</span> <span style=color:#ed9d13>&#34;Microsoft 365 Apps Detected&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#3677a9>0</span>
</span></span><span style=display:flex><span>} <span style=color:#6ab825;font-weight:700>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#ed9d13>&#34;</span>$(<span style=color:#24909d>Get-Date</span> -Format <span style=color:#ed9d13>&#39;yyyy-MM-dd HH:mm:ss&#39;</span>)<span style=color:#ed9d13> - Microsoft 365 Apps not detected&#34;</span> | <span style=color:#24909d>Out-File</span> -FilePath <span style=color:#40ffff>$LogFile</span> -Append
</span></span><span style=display:flex><span>    exit <span style=color:#3677a9>1</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=m365-apps-win32-application-program-settings>M365 Apps Win32 Application Program Settings</h3><p>The new Intune Win32 application called &ldquo;<em>GBL-WIN11-M365Apps-v2</em>&rdquo; is using an install command which calls the PS script: <em>Install-M365Apps.ps1</em> and the uninstall command calls the other PS script: <em>Uninstall-M365Apps.ps1</em>. Installation time is set to 60 minutes to accommodate the CDN download and the app runs in System context:</p><p><img src=/images/Blog_P14_108.jpg alt></p><h3 id=m365-apps-custom-detection-script-configuration>M365 Apps Custom Detection Script Configuration</h3><p>For the Detection rules I&rsquo;m using my custom PowerShell script that logs directly to:
&ldquo;<em>C:\ProgramData\Microsoft\IntuneManagementExtension\Logs\M365Apps-Detection.log</em>&rdquo;.</p><p>Using a custom detection script instead of a basic file or registry check provides clear detection logic, troubleshooting visibility and confirmation that Office is fully installed and usable:</p><p><img src=/images/Blog_P14_109.jpg alt></p><h3 id=company-portal-downloading-m365-apps>Company Portal Downloading M365 Apps</h3><p>The Company Portal displays the deployment progress of <strong>GBL-WIN11-M365Apps-v2</strong>:</p><p><img src=/images/Blog_P14_083.jpg alt></p><h3 id=intunemanagementextension-appworkload-log-analysis>IntuneManagementExtension AppWorkload Log Analysis</h3><p>The log &ldquo;<em>AppWorkload.log</em>&rdquo; shows the detection script returning <em>applicationDetected: False</em>, followed by the execution handler launching the install.
The highlighted line confirms the PowerShell installer is executed from the <strong>IMECache</strong> folder, which is expected behavior for Win32 apps:</p><p><img src=/images/Blog_P14_085.jpg alt></p><h3 id=imecache-folder-with-extracted-win32-app-contents>IMECache Folder with Extracted Win32 App Contents</h3><p>The &ldquo;<em>C:\Windows\IMECache</em>&rdquo; folder shows the extracted contents of the M365 Apps Win32 package with the unique app GUID folder name. The contents include the install script (renamed with a GUID prefix) along with the other three files addressed above: M365Apps.xml, remove.xml and setup.exe.</p><p>Note: This is where Intune temporarily extracts Win32 app packages before execution and examining this location is valuable for troubleshooting deployment issues.</p><p><img src=/images/Blog_P14_086.jpg alt></p><h3 id=m365-apps-installation-transcript-log>M365 Apps Installation Transcript Log</h3><p>The output for the custom log &ldquo;<em>M365Apps-Current-install.log</em>&ldquo;is capturing the installation process, the highlighted line showing the <strong>setup.exe</strong> command being executed: <em>setup.exe /configure &ldquo;M365Apps.xml&rdquo;</em>.</p><p>Note: This transcript logging provides valuable troubleshooting information for deployment issues.</p><p><img src=/images/Blog_P14_088.jpg alt></p><h3 id=task-manager-showing-throttled-network-speed>Task Manager Showing Throttled Network Speed</h3><p>At this point, Task Manager revealed the real issue.
Despite a Gigabit network adapter, network throughput was capped at approximately <strong>1.1 Mbps</strong> showing constant throttling spikes. At this speed downloading ~4 GB of Office content would take <strong>25–38 hours</strong> which is obviously unacceptable for production or Autopilot deployments.</p><p><img src=/images/Blog_P14_000.jpg alt></p><h3 id=optional-monitoring-office-installation-progress>(Optional) Monitoring Office Installation Progress</h3><p>After adjusting the Delivery Optimization settings, I&rsquo;ve used the following monitoring PS script which showed Office folder growth from <strong>2.05 GB</strong> to <strong>4.18 GB</strong> in under 2 minutes, followed by confirmation that <em>WINWORD.EXE</em> was installed.</p><p>This clearly demonstrated that the bottleneck was not the installer or CDN but the local DO configuration:</p><p>Estimated download impact M365 Office folders size ~4,200 MB (4.2 GB)</p><ul><li><p><strong>Before DO optimization:</strong><br>~1.1 Mbps (≈ 8 MB/min) → <strong>~8.5 hours (theoretical minimum)</strong></p></li><li><p><strong>After DO optimization:</strong><br>~27 Mbps (≈ 200 MB/min) → <strong>~21 minutes</strong></p></li></ul><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span><span style=color:#6ab825;font-weight:700>while</span> (!(<span style=color:#24909d>Test-Path</span> <span style=color:#ed9d13>&#34;C:\Program Files\Microsoft Office\root\Office16\WINWORD.EXE&#34;</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#40ffff>$size</span> = [<span style=color:#40ffff>math</span>]::Round((<span style=color:#24909d>Get-ChildItem</span> <span style=color:#ed9d13>&#34;C:\Program Files\Microsoft Office&#34;</span> -Recurse -ErrorAction SilentlyContinue | <span style=color:#24909d>Measure-Object</span> -Property Length -Sum).Sum / <span style=color:#3677a9>1</span>GB, <span style=color:#3677a9>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;</span>$(<span style=color:#24909d>Get-Date</span> -Format <span style=color:#ed9d13>&#39;HH:mm:ss&#39;</span>)<span style=color:#ed9d13> - Office folder: </span><span style=color:#40ffff>$size</span><span style=color:#ed9d13> GB - Waiting for WINWORD.EXE...&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#24909d>Start-Sleep</span> -Seconds <span style=color:#3677a9>15</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;WINWORD.EXE INSTALLED!&#34;</span> -ForegroundColor Green
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># Final verification</span>
</span></span><span style=display:flex><span><span style=color:#40ffff>$office</span> = <span style=color:#24909d>Get-ItemProperty</span> -Path <span style=color:#ed9d13>&#34;HKLM:\SOFTWARE\Microsoft\Office\ClickToRun\Configuration&#34;</span>
</span></span><span style=display:flex><span><span style=color:#24909d>Write-Host</span> <span style=color:#ed9d13>&#34;Version: </span>$(<span style=color:#40ffff>$office</span>.VersionToReport)<span style=color:#ed9d13>&#34;</span>
</span></span></code></pre></div><p>This dramatic improvement from the previous 1.1 Mbps throttled speed demonstrates the impact of proper DO configuration.</p><p><img src=/images/Blog_P14_100.jpg alt></p><h3 id=original-delivery-optimization-policy-settings>Original Delivery Optimization Policy Settings</h3><p>The original policy <strong>GBL-WIN11-Delivery-Optimization-(ALL)</strong> revealed the issues:</p><ul><li>Max Background Bandwidth: 25%</li><li>Max Foreground Bandwidth: 50%</li><li>Combined with HTTP delay settings</li></ul><p>In a single-device environment with no peers these limits only reduced performance and provided no P2P benefit. More importantly these settings also apply during Autopilot and ESP, meaning they directly affect foreground installs like Microsoft 365 Apps.</p><p><img src=/images/Blog_P14_098.jpg alt></p><p>While reviewing different perspectives on Delivery Optimization behavior, two voices stood out as particularly aligned and practical: <strong>Johan Arwidmark</strong> (2Pint Software), approaching the topic from bandwidth optimization and peer-to-peer efficiency and <strong>Rudy Ooms</strong> (Patch My PC), drawing conclusions from real-world Autopilot failure analysis, each arriving at similar recommendations from very different angles.</p><p>Despite different perspectives I&rsquo;ve noticed that both converge on the same practical values:</p><ul><li>Foreground delay: <strong>60 seconds</strong></li><li>Background delay: <strong>600 seconds</strong></li></ul><p>The difference isn’t the numbers but how they were validated, Johan optimizes for scale while Rudy identified these values by troubleshooting what breaks Autopilot and ESP when foreground apps wait too long for peers that don’t exist.</p><p>Microsoft official documentation remains the baseline but it does not always surface the full behavioral impact of these settings especially during Autopilot, Community testing and failure analysis often fill that gap.</p><p>The key lesson is to avoid copying settings blindly, <em>Delivery Optimization</em> must be addressed on a per-tenant basis, aligned with network design, operational constraints and agreed with the relevant networking and endpoint stakeholders.</p><p>Here are the adjusted settings that resolved the issue in my environment:</p><p><img src=/images/Blog_P14_002.jpg alt></p><p>The contrast with the previous throttled state is dramatic, Task Manager now shows an improved speed of <strong>27.1 Mbps</strong> with peaks reaching <strong>54 Mbps</strong>, roughly <strong>25 times faster</strong> than the original restrictive configuration. With Delivery Optimization no longer artificially constraining bandwidth, an installation that previously risked turning into a 25+ hour now completes in minutes:</p><p><img src=/images/Blog_P14_009.png alt></p><h3 id=m365-apps-installation-transcript-completed-successfully>M365 Apps Installation Transcript Completed Successfully</h3><p>Finally the installation log confirms <strong>Exit code: 0</strong> and Company Portal confirming the app has been deployment successfully, the entire Win32 app deployment workflow functioned correctly from CDN download through installation to detection:</p><p><img src=/images/Blog_P14_102.jpg alt></p><p><img src=/images/Blog_P14_104.jpg alt></p><h3 id=registry-verification-of-m365-apps-installation-configuration>Registry Verification of M365 Apps Installation Configuration</h3><p>In the following registry key you can find information about the Microsoft 365 Apps installation including the <strong>Click-to-Run</strong> configuration:</p><p><em>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\ClickToRun\Configuration</em></p><p>This registry location is authoritative for validating how M365 Apps were installed and whether the deployment matches the Office Deployment Tool (ODT) XML configuration used during installation.</p><p>The <em>ProductReleaseIds</em> value shows <strong>O365BusinessRetail</strong>, confirming the expected product SKU.<br>The <em>O365BusinessRetail.ExcludedApps</em> value lists <em>groove</em>, <em>lync</em> and <em>bing</em>, validating that the XML exclusions for OneDrive for Business, Skype for Business, and Bing were correctly applied during installation.</p><p>The <em>O365BusinessRetail.MediaType</em> value is set to <strong>CDN</strong>, confirming this was an evergreen deployment sourcing content directly from Microsoft’s CDN rather than from local or offline media. The <em>VersionToReport</em> value (16.0.19530.20184) confirms the specific Monthly Enterprise Channel build that was installed at the time.</p><p>It’s worth noting that while the registry shows <em>UpdatesEnabled</em> set to <strong>True</strong>, the update behavior is not controlled here alone. In my environment update configuration is enforced by a separate Intune policy (<em>GBL-WIN11-M365AppsUpdates-Current-(DEV)</em>) which sets the update channel, enables automatic updates with zero deferral and prevents users from disabling updates:</p><p><img src=/images/Blog_P14_003.jpg alt></p><h3 id=windows-settings-delivery-optimization>Windows Settings Delivery Optimization</h3><p>The Windows Settings page under <strong>Windows Update > Advanced options > Delivery Optimization</strong> confirms that the Delivery Optimization policy is applied at the OS level.</p><p>The Activity Monitor shows:</p><ul><li>From Microsoft: 100% (1.3 GB)</li><li>From PCs on your local network: 0%</li></ul><p>This behavior is expected and correct in a single-device lab environment with no eligible peers available, Delivery Optimization falls back entirely to CDN downloads even though peer-to-peer is enabled and ready to be used when peers exist.</p><p>Note: This screen validates source selection behavior not the bandwidth efficiency.</p><p><img src=/images/Blog_P14_004.jpg alt></p><h3 id=powershell-delivery-optimization-status-verification>PowerShell Delivery Optimization Status Verification</h3><p>The PowerShell command <em>Get-DeliveryOptimizationPerfSnap</em> provides a runtime snapshot of Delivery Optimization behavior and effective settings:</p><p><img src=/images/Blog_P14_008.jpg alt></p><p>Key values confirm correct operation:</p><ul><li><p><em>DownloadMode: Lan</em><br>Indicates that peer-to-peer is enabled and scoped to the local network, even though peers are not currently available.</p></li><li><p><em>NumberOfPeers: 0</em><br>Confirms the expected single-device lab scenario.</p></li><li><p><em>ForegroundDownloadRatePct: 90</em></p></li><li><p><em>BackgroundDownloadRatePct: 45</em></p></li></ul><p>These values are particularly important since they demonstrate that Windows is dynamically calculating bandwidth usage rather than being constrained by static, policy-enforced percentage limits. This behavior only becomes possible after removing explicit foreground and background bandwidth caps from the Intune Delivery Optimization policy.</p><h2 id=final-takeaway>Final takeaway</h2><p>Delivery Optimization works best when it is allowed to adapt.<br>Hard limits should be the exception, not the default and settings must be evaluated per tenant, aligned with both official Microsoft guidance and real-world community experience.</p></div><footer class=post-footer><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><a href=https://halfoncloud.com/posts/m365-business-premium-part-5-intune-conditional-access-policies/ class="button inline next">[<span class=button__text>M365 Business Premium Part 5: Conditional Access Policies</span>] ></a></div></div></footer></article></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user" style=text-align:center><span>&copy; 2026 Radu Bogdan :: HalfOnCloud</span></div></div></footer><script type=text/javascript src=/bundle.min.js></script><style>.image-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:9999;cursor:pointer;justify-content:center;align-items:center}.image-overlay.active{display:flex}.image-overlay img{max-width:95%;max-height:95%;border:2px solid #fff;object-fit:contain}article img{cursor:pointer}</style><div class=image-overlay id=imageOverlay><img src alt="Enlarged image" id=overlayImage></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("imageOverlay"),t=document.getElementById("overlayImage");document.querySelectorAll("article img").forEach(function(n){n.addEventListener("click",function(){t.src=this.src,e.classList.add("active")})}),e.addEventListener("click",function(){e.classList.remove("active")}),document.addEventListener("keydown",function(t){t.key==="Escape"&&e.classList.remove("active")})})</script><script>(function(){let n=null;const t=document.getElementById("search-input"),e=document.getElementById("search-results");if(!t||!e)return;fetch("/index.json").then(e=>e.json()).then(e=>{n=e}).catch(e=>console.log("Search index not found"));function o(e,t){let n;return function(...s){clearTimeout(n),n=setTimeout(()=>e.apply(this,s),t)}}function s(t){if(!n||t.length<2){e.innerHTML="";return}const s=n.filter(e=>{const n=(e.title+" "+e.contents+" "+(e.tags||[]).join(" ")).toLowerCase();return n.includes(t.toLowerCase())}).slice(0,8);if(s.length===0){e.innerHTML='<div class="search-no-results">No results found</div>';return}e.innerHTML=s.map(e=>{const o=e.contents.toLowerCase(),i=t.toLowerCase();let n="";const s=o.indexOf(i);if(s!==-1){const o=Math.max(0,s-40),i=Math.min(e.contents.length,s+t.length+60);n=(o>0?"...":"")+e.contents.substring(o,i)+(i<e.contents.length?"...":"")}else n=e.contents.substring(0,100)+"...";return`
                <div class="search-result-item">
                    <a href="${e.permalink}">${e.title}</a>
                    <div class="search-date">${e.date}</div>
                    <div class="search-snippet">${n}</div>
                </div>
            `}).join("")}t.addEventListener("input",o(function(e){s(e.target.value.trim())},300)),document.addEventListener("click",function(n){!t.contains(n.target)&&!e.contains(n.target)&&(e.innerHTML="")}),t.addEventListener("focus",function(){this.value.length>=2&&s(this.value.trim())})})()</script></div></body></html>